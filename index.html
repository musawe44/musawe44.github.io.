<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MUSAWI</title>
  <meta name="theme-color" content="#0b1220">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.18);
      --text: #eef2ff;
      --muted:#d1d5db;
      --shadow: 0 18px 40px rgba(0,0,0,.38);
      --glass: rgba(255,255,255,.07);
      --glass2: rgba(255,255,255,.05);
      --accent: rgba(34,197,94,.95);
    }
    body.light{
      --bg:#f4f6ff;
      --card: rgba(0,0,0,.06);
      --border: rgba(0,0,0,.12);
      --text:#0b1220;
      --muted:#334155;
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --glass: rgba(255,255,255,.62);
      --glass2: rgba(255,255,255,.40);
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      color:var(--text);
      min-height:100vh;
      background: var(--bg);
      overflow-x:hidden;
      padding: 175px 14px 22px;
    }

    /* ÿÆŸÑŸÅŸäÿ© ŸÅŸäÿØŸäŸà */
    .bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-6;
      transform: scale(1.02);
      filter: saturate(1.08) contrast(1.05);
    }
    .overlay{
      position:fixed; inset:0;
      z-index:-5;
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.12), transparent 55%),
        linear-gradient(120deg, rgba(11,18,32,.30), rgba(11,18,32,.18));
      transition: opacity .25s ease, filter .25s ease;
    }
    body.light .overlay{
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.14), transparent 55%),
        linear-gradient(120deg, rgba(255,255,255,.28), rgba(255,255,255,.18));
    }

    /* ===== HUD ÿßŸÑÿ≥ÿßÿπÿ© ===== */
    .topHUD{
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: min(980px, calc(100% - 20px));
      z-index: 70;
      pointer-events:none;
    }
    .timeBig{
      text-align:center;
      font-weight: 900;
      letter-spacing: .5px;
      font-size: 68px;
      line-height: 1;
      color: rgba(255,255,255,.92);
      text-shadow:none;
      filter:none;
      pointer-events:none;
    }
    body.light .timeBig{ color: rgba(10,16,28,.88); }

    .timeGhost{
      position:absolute;
      inset: -10px 0 auto 0;
      text-align:center;
      font-weight: 900;
      font-size: 92px;
      line-height: 1;
      color: rgba(255,255,255,.10);
      text-shadow:none;
      filter:none;
      transform: translateY(22px);
      user-select:none;
      pointer-events:none;
    }
    body.light .timeGhost{ color: rgba(10,16,28,.10); }

    .hudRow{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: var(--glass);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      pointer-events:auto;
    }
    body.light .hudRow{
      border-color: rgba(0,0,0,.10);
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
    }

    .hudDate, .hudWx{
      font-weight: 800;
      font-size: 14px;
      color: rgba(255,255,255,.92);
      white-space:nowrap;
    }
    body.light .hudDate, body.light .hudWx{ color: rgba(10,16,28,.82); }

    .previewBtn{
      pointer-events:auto;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 8px 12px;
      border-radius: 14px;
      font-family: inherit;
      font-weight: 900;
      cursor: pointer;
      white-space:nowrap;
    }
    .previewBtn:hover{ background: rgba(255,255,255,.14); }
    body.light .previewBtn{
      border-color: rgba(0,0,0,.10);
      background: rgba(0,0,0,.04);
      color: rgba(10,16,28,.86);
    }

    @media (max-width: 560px){
      body{ padding-top: 185px; }
      .timeBig{ font-size: 56px; }
      .timeGhost{ font-size: 78px; }
      .hudRow{ gap:8px; }
      .previewBtn{ padding: 8px 10px; font-size: 13px; }
      .hudDate, .hudWx{ font-size: 13px; }
    }

    /* ===== Layout ===== */
    .grid{
      width:min(980px, 100%);
      margin: 0 auto;
      display:grid;
      gap:16px;
      grid-template-columns: 1.2fr .8fr;
      align-items:start;
      position:relative;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
      animation: enter 820ms cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes enter{
      from{ opacity:0; transform: translateY(18px) scale(.99); filter: blur(8px); }
      to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(680px 220px at 15% 0%, rgba(255,255,255,.12), transparent 60%);
      opacity:0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
    .card:hover::before{ opacity:1; }

    .hero{
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .photo{
      width: 92px;
      height: 92px;
      border-radius: 20px;
      border: 1px solid var(--border);
      object-fit: cover;
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
      margin-top: 2px;
    }
    h1{
      margin:0;
      font-size: 32px;
      font-weight: 900;
      letter-spacing:.3px;
      line-height:1.05;
    }
    .subtitle{
      margin: 8px 0 0;
      color: var(--muted);
      font-weight: 900;
      font-size: 17px;
    }
    .badges{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      font-size: 14px;
      font-weight: 900;
      color: var(--text);
      white-space:nowrap;
    }
    body.light .badge{
      border-color: rgba(0,0,0,.10);
      background: rgba(0,0,0,.03);
    }

    .sectionTitle{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
    }

    /* ===== ŸÉŸÑŸÖÿ© ŸÖŸÜ Google Sheet ===== */
    .bigNote{
      margin:0;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: var(--glass2);
      line-height: 2.1;
      font-size: 21px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    body.light .bigNote{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
    }

    /* ===== ÿ™ŸàÿßÿµŸÑ ÿ™ÿ≠ÿ™ ÿßŸÑŸÉŸÑŸÖÿ© ===== */
    .socialRow{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .socLink{
      flex: 1 1 180px;
      text-decoration:none;
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      transition: transform .18s ease, background .18s ease;
      position:relative;
      overflow:hidden;
      font-weight: 900;
    }
    .socLink:hover{ transform: translateY(-2px); background: rgba(255,255,255,.10); }

    .socLeft{ display:flex; align-items:center; gap:10px; }
    .socIco{
      width: 34px; height:34px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.10);
      border: 1px solid var(--border);
    }
    body.light .socLink{ background: rgba(0,0,0,.03); }
    body.light .socIco{ background: rgba(0,0,0,.04); }

    /* ===== YouTube ===== */
    .video{
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.20);
      aspect-ratio: 16/9;
    }
    .video iframe{ width:100%; height:100%; border:0; display:block; }

    /* ===== Audio ===== */
    .audioTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
    }
    body.light .audioTop{ background: rgba(0,0,0,.03); }

    .navBtns{ display:flex; gap:8px; align-items:center; }
    .navBtn, .playBtn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-family:inherit;
      font-weight: 900;
      line-height:1;
      white-space:nowrap;
    }
    .navBtn:hover, .playBtn:hover{ background: rgba(255,255,255,.14); }
    body.light .navBtn, body.light .playBtn{
      background: rgba(0,0,0,.04);
      color: rgba(10,16,28,.86);
      border-color: rgba(0,0,0,.10);
    }

    .trackTitle{
      margin:0;
      font-size: 13px;
      font-weight: 900;
      color: var(--muted);
      flex:1;
      text-align:right;
      line-height:1.3;
    }

    .volWrap{
      margin-top: 10px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
    }
    body.light .volWrap{ background: rgba(0,0,0,.03); }

    .volLabel{ font-weight: 900; font-size: 13px; color: var(--muted); white-space:nowrap; }
    .volume{ width:100%; accent-color: var(--accent); }

    .vizWrap{
      margin-top: 10px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
    }
    body.light .vizWrap{ border-color: rgba(0,0,0,.10); background: rgba(0,0,0,.03); }
    #viz{ width:100%; height:120px; display:block; }

    /* ===== Footer ===== */
    footer{
      margin-top: 16px;
      width:min(980px, 100%);
      margin-left:auto; margin-right:auto;
      text-align:center;
      color: rgba(255,255,255,.88);
      font-weight: 900;
      font-size: 14px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
    }
    body.light footer{ color: rgba(10,16,28,.82); background: rgba(0,0,0,.03); }

    /* ===== Night toggle bottom-left ===== */
    .nightToggle{
      position: fixed;
      left: 12px;
      bottom: 12px;
      z-index: 80;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
    }
    body.light .nightToggle{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
    }
    .nightToggle button{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 8px 10px;
      border-radius: 14px;
      cursor:pointer;
      font-family: inherit;
      font-weight: 900;
    }
    body.light .nightToggle button{
      border-color: rgba(0,0,0,.10);
      background: rgba(0,0,0,.04);
      color: rgba(10,16,28,.86);
    }
    .nightLabel{ font-weight: 900; font-size: 13px; color: rgba(255,255,255,.92); }
    body.light .nightLabel{ color: rgba(10,16,28,.82); }

    /* =========================
       11:11 BLACK FX Overlay
    ========================= */
    .fx1111{
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #000;
      display: none;
      overflow: hidden;
    }
    .fx1111.show{ display:block; }

    #fxCanvas{
      width: 100%;
      height: 100%;
      display: block;
    }

    .fxHint{
      position:absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,.72);
      font-weight: 900;
      font-size: 18px;
      letter-spacing: .4px;
      user-select:none;
      pointer-events:none;
    }
  </style>
</head>

<body>
  <!-- ŸÅŸäÿØŸäŸà ÿßŸÑÿÆŸÑŸÅŸäÿ© -->
  <video class="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <!-- ÿ±ÿ£ÿ≥ ÿßŸÑÿµŸÅÿ≠ÿ© -->
  <div class="topHUD">
    <div class="timeGhost" id="timeGhost">11:11</div>
    <div class="timeBig" id="timeNow">--:--</div>

    <div class="hudRow">
      <div class="hudDate" id="dateTxt">...</div>
      <button class="previewBtn" id="preview1111">ŸÖÿßÿ∞ÿß Ÿäÿ≠ÿØÿ´ ÿπŸÜÿØ 11:11ÿü</button>
      <div class="hudWx" id="wxTxt">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿ∑ŸÇÿ≥ ÿßŸÑÿ®ÿµÿ±ÿ©...</div>
    </div>
  </div>

  <main class="grid">
    <!-- ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ™ÿπÿ±ŸäŸÅ + ŸÉŸÑŸÖÿ© + ÿ™ŸàÿßÿµŸÑ -->
    <section class="card">
      <div class="hero">
        <img class="photo" src="avatar.jpg" alt="ÿµŸàÿ±ÿ™Ÿä">
        <div style="flex:1">
          <h1>MUSAWI</h1>
          <p class="subtitle">ÿ∑ÿßŸÑÿ® <span style="letter-spacing:.4px">GEOLOGY</span> ‚Äî ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ®ÿµÿ±ÿ©</p>

          <div class="badges">
            <span class="badge">üìö ÿ™ÿπŸÑŸëŸÖ</span>
            <span class="badge">üíª ÿÆÿ®ÿ±ÿ© ÿ®ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿßÿ™</span>
            <span class="badge">üìç ÿßŸÑÿ®ÿµÿ±ÿ©</span>
          </div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.14); margin:14px 0;">

      <h2 class="sectionTitle">ŸÉŸÑŸÖÿ©</h2>
      <p class="bigNote" id="mainQuote">... ÿ™ÿ≠ŸÖŸäŸÑ</p>

      <div class="socialRow">
        <a class="socLink" href="https://t.me/Mu29_iq" target="_blank" rel="noopener">
          <span class="socLeft">
            <span class="socIco" aria-hidden="true">
              <!-- Telegram SVG -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M21.8 4.3c.3-1.2-.9-2-2-1.6L3.7 8.9c-1.1.4-1.1 2 .1 2.3l4.1 1.2 1.6 5c.3 1 1.6 1.3 2.4.6l2.3-2.1 4 3c.9.7 2.2.2 2.5-.9L21.8 4.3Z" fill="currentColor" opacity=".95"/>
                <path d="M9.2 12.6l9.4-6.3c.2-.1.4.2.2.4l-7.8 7.5c-.3.3-.5.7-.4 1.1l.4 2.9c.1.5-.5.7-.8.3l-1.7-3.4c-.3-.5-.7-.9-1.2-1l-3.1-1c-.5-.2-.5-.9 0-1.1l16-6.2" fill="currentColor"/>
              </svg>
            </span>
            Telegram
          </span>
          <span>‚Üó</span>
        </a>

        <a class="socLink" href="https://www.instagram.com/mu29__/" target="_blank" rel="noopener">
          <span class="socLeft">
            <span class="socIco" aria-hidden="true">
              <!-- Instagram SVG -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Z" stroke="currentColor" stroke-width="2" opacity=".95"/>
                <path d="M12 16.1A4.1 4.1 0 1 0 12 8a4.1 4.1 0 0 0 0 8.1Z" stroke="currentColor" stroke-width="2"/>
                <path d="M17.6 6.9h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
              </svg>
            </span>
            Instagram
          </span>
          <span>‚Üó</span>
        </a>
      </div>
    </section>

    <!-- ÿ®ÿ∑ÿßŸÇÿ© ŸäŸàÿ™ŸäŸàÿ® + ŸÖŸàÿ≥ŸäŸÇŸâ -->
    <section class="card">
      <h2 class="sectionTitle">ÿµŸàÿ±ÿ© ŸÖŸàÿ≥ŸäŸÇŸâ</h2>
      <div class="video">
        <iframe
          src="https://www.youtube.com/embed/BXChU6bMEXU"
          title="YouTube video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.14); margin:14px 0;">

      <h2 class="sectionTitle">ŸÖŸàÿ≥ŸäŸÇŸâ</h2>

      <div class="audioTop">
        <div class="navBtns">
          <button class="navBtn" id="prevTrack" title="ÿßŸÑÿ≥ÿßÿ®ŸÇ">‚óÄ</button>
          <button class="navBtn" id="nextTrack" title="ÿßŸÑÿ™ÿßŸÑŸä">‚ñ∂</button>
        </div>

        <p class="trackTitle" id="trackTitle">ÿßŸÑŸÖŸÇÿ∑ÿπ: 1</p>

        <button class="playBtn" id="audioBtn">ÿ™ÿ¥ÿ∫ŸäŸÑ</button>
      </div>

      <div class="volWrap">
        <span class="volLabel">ÿÆŸÅÿ∂ ÿßŸÑÿµŸàÿ™</span>
        <input class="volume" id="volume" type="range" min="0" max="100" value="70">
      </div>

      <div class="vizWrap">
        <canvas id="viz"></canvas>
      </div>

      <audio id="bgAudio" preload="metadata" loop></audio>
    </section>
  </main>

  <footer>
    ¬© <span id="y"></span> ‚Äî ÿ•ŸêŸÜŸëŸé ŸÖŸéÿπŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê ŸäŸèÿ≥Ÿíÿ±Ÿãÿß
  </footer>

  <!-- Ÿàÿ∂ÿπ ŸÑŸäŸÑŸä -->
  <div class="nightToggle">
    <span class="nightLabel">ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä</span>
    <button id="toggleTheme">ÿ™ÿ¥ÿ∫ŸäŸÑ/ÿ•ÿ∑ŸÅÿßÿ°</button>
  </div>

  <!-- ===== 11:11 BLACK FX ===== -->
  <div class="fx1111" id="fx1111" aria-hidden="true">
    <canvas id="fxCanvas"></canvas>
    <div class="fxHint">11:11</div>
  </div>

  <script>
    // ===== ÿ≥ŸÜÿ© ÿßŸÑŸÅŸàÿ™ÿ± =====
    document.getElementById("y").textContent = new Date().getFullYear();

    // ===== Google Sheet: ŸÜŸÇÿ±ÿ£ B1 ŸàŸÜÿÆŸÑŸäŸá ÿßŸÑŸÜÿµ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä =====
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXkdu2p1KVIjDPGdb97HfmkKa2WuvKN349Z5qdZOd_RTCyT__xNLL44swa0EUAnq614hxS9p52NSlL/pub?gid=0&single=true&output=csv";

    fetch(SHEET_CSV_URL, { cache: "no-store" })
      .then(res => res.text())
      .then(text => {
        text = text.replace(/^\uFEFF/, "");
        const commaIndex = text.indexOf(",");
        if (commaIndex === -1) return;
        let value = text.slice(commaIndex + 1).trim();
        value = value.replace(/^"|"$/g, "");
        if (value) document.getElementById("mainQuote").textContent = value;
      })
      .catch(()=>{});

    // ===== Iraq time + Date =====
    const timeNow = document.getElementById("timeNow");
    const timeGhost = document.getElementById("timeGhost");
    const dateTxt = document.getElementById("dateTxt");

    function formatIraqTime(){
      const now = new Date();
      return new Intl.DateTimeFormat("en-GB", {
        timeZone: "Asia/Baghdad",
        hour: "2-digit",
        minute: "2-digit"
      }).format(now);
    }

    function formatIraqDate(){
      const now = new Date();
      return new Intl.DateTimeFormat("ar-IQ", {
        timeZone: "Asia/Baghdad",
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric"
      }).format(now);
    }

    // ===== Basra Weather (Open-Meteo, no key) =====
    const wxTxt = document.getElementById("wxTxt");
    const lat = 30.5085;
    const lon = 47.7804;

    function codeToArabic(code){
      if (code === 0) return ["‚òÄÔ∏è","ÿµÿ≠Ÿà"];
      if ([1,2].includes(code)) return ["üå§Ô∏è","ÿ∫ÿßÿ¶ŸÖ ÿ¨ÿ≤ÿ¶ŸäÿßŸã"];
      if (code === 3) return ["‚òÅÔ∏è","ÿ∫ÿßÿ¶ŸÖ"];
      if ([45,48].includes(code)) return ["üå´Ô∏è","ÿ∂ÿ®ÿßÿ®"];
      if ([51,53,55].includes(code)) return ["üå¶Ô∏è","ÿ±ÿ∞ÿßÿ∞"];
      if ([61,63,65].includes(code)) return ["üåßÔ∏è","ŸÖÿ∑ÿ±"];
      if ([71,73,75,77].includes(code)) return ["üå®Ô∏è","ÿ´ŸÑÿ¨"];
      if ([80,81,82].includes(code)) return ["üåßÔ∏è","ÿ≤ÿÆÿßÿ™"];
      if ([95,96,99].includes(code)) return ["‚õàÔ∏è","ÿπÿßÿµŸÅÿ©"];
      return ["‚õÖ","ŸÖÿ™ÿ∫Ÿäÿ±"];
    }

    async function fetchWeather(){
      try{
        const url =
          `https://api.open-meteo.com/v1/forecast` +
          `?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,weather_code` +
          `&timezone=Asia%2FBaghdad`;

        const res = await fetch(url, { cache: "no-store" });
        const data = await res.json();
        const temp = Math.round(data.current.temperature_2m);
        const code = data.current.weather_code;
        const [ico, desc] = codeToArabic(code);
        wxTxt.textContent = `ÿßŸÑÿ®ÿµÿ±ÿ©: ${temp}¬∞ ‚Äî ${desc} ${ico}`;
      }catch(e){
        wxTxt.textContent = "ÿ™ÿπÿ∞ÿ± ÿ¨ŸÑÿ® ÿ∑ŸÇÿ≥ ÿßŸÑÿ®ÿµÿ±ÿ©";
      }
    }
    fetchWeather();
    setInterval(fetchWeather, 10 * 60 * 1000);

    // ===== Theme toggle =====
    const toggleTheme = document.getElementById("toggleTheme");
    const savedTheme = localStorage.getItem("themeMode");
    if(savedTheme === "light") document.body.classList.add("light");

    toggleTheme.addEventListener("click", () => {
      document.body.classList.toggle("light");
      localStorage.setItem("themeMode", document.body.classList.contains("light") ? "light" : "dark");
    });

    // ===== Audio playlist (ŸÖÿ∑ÿßÿ®ŸÇ ŸÑÿ£ÿ≥ŸÖÿßÿ° ŸÖŸÑŸÅÿßÿ™ŸÉ) =====
    const tracks = [
      { title: "ÿßŸÑŸÖŸÇÿ∑ÿπ 1", file: "audio.mp3.mp3.mp3" },
      { title: "ÿßŸÑŸÖŸÇÿ∑ÿπ 2", file: "audio1.mp3.mp3" }
    ];
    const elevenTrack = { title: "11:11 Special", file: "eleven.mp3.mp3" };

    const audioEl = document.getElementById("bgAudio");
    const btnPlay = document.getElementById("audioBtn");
    const vol = document.getElementById("volume");
    const titleEl = document.getElementById("trackTitle");
    const prevBtn = document.getElementById("prevTrack");
    const nextBtn = document.getElementById("nextTrack");

    const canvas = document.getElementById("viz");
    const ctx = canvas.getContext("2d");

    // ŸÖŸáŸÖ: ŸÜÿÆŸÑŸäŸáŸÖ global ÿ≠ÿ™Ÿâ FX Ÿäÿ≥ÿ™ÿÆÿØŸÖŸáŸÖ
    window.audioCtx = null;
    window.analyser = null;
    window.freqData = null;
    let srcNode = null;

    let rafId = null;
    let playing = false;
    let trackIndex = 0;

    function setTrack(i){
      trackIndex = (i + tracks.length) % tracks.length;
      const t = tracks[trackIndex];
      audioEl.src = t.file;
      titleEl.textContent = `ÿßŸÑŸÖŸÇÿ∑ÿπ: ${trackIndex + 1} ‚Äî ${t.title}`;
    }
    setTrack(0);

    audioEl.volume = (Number(vol.value)||70)/100;
    vol.addEventListener("input", () => audioEl.volume = (Number(vol.value)||0)/100);

    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function ensureAudioGraph(){
      if(window.audioCtx) return;
      window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      window.analyser = window.audioCtx.createAnalyser();
      window.analyser.fftSize = 2048;
      window.analyser.smoothingTimeConstant = 0.82;
      window.freqData = new Uint8Array(window.analyser.frequencyBinCount);

      srcNode = window.audioCtx.createMediaElementSource(audioEl);
      srcNode.connect(window.analyser);
      window.analyser.connect(window.audioCtx.destination);
    }

    function drawBars(){
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;

      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "rgba(255,255,255,0.03)";
      ctx.fillRect(0,0,w,h);

      if(!window.analyser || !window.freqData){
        rafId = requestAnimationFrame(drawBars);
        return;
      }

      window.analyser.getByteFrequencyData(window.freqData);

      const bars = 64;
      const step = Math.floor(window.freqData.length / bars);
      const barW = w / bars;

      for(let i=0;i<bars;i++){
        const v = window.freqData[i*step] / 255;
        const barH = Math.max(6, v * (h - 12));
        const x = i * barW;
        const y = h - barH;
        ctx.fillStyle = "rgba(255,255,255,0.78)";
        ctx.fillRect(x + barW*0.18, y, barW*0.64, barH);
      }

      rafId = requestAnimationFrame(drawBars);
    }

    function startViz(){
      if(rafId) cancelAnimationFrame(rafId);
      drawBars();
    }
    function stopViz(){
      if(rafId) cancelAnimationFrame(rafId);
      rafId = null;
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "rgba(255,255,255,0.03)";
      ctx.fillRect(0,0,w,h);
    }
    stopViz();

    async function playPause(){
      try{
        ensureAudioGraph();
        if(window.audioCtx.state === "suspended") await window.audioCtx.resume();

        if(!playing){
          await audioEl.play();
          playing = true;
          btnPlay.textContent = "ÿ•ŸäŸÇÿßŸÅ";
          startViz();
        }else{
          audioEl.pause();
          playing = false;
          btnPlay.textContent = "ÿ™ÿ¥ÿ∫ŸäŸÑ";
          stopViz();
        }
      }catch(e){
        btnPlay.textContent = "ÿßÿ∂ÿ∫ÿ∑ ŸÖÿ±ÿ© ÿ´ÿßŸÜŸäÿ©";
      }
    }

    btnPlay.addEventListener("click", playPause);

    prevBtn.addEventListener("click", async () => {
      const was = playing;
      if(was){ audioEl.pause(); playing=false; }
      setTrack(trackIndex - 1);
      btnPlay.textContent = "ÿ™ÿ¥ÿ∫ŸäŸÑ";
      stopViz();
      if(was) await playPause();
    });

    nextBtn.addEventListener("click", async () => {
      const was = playing;
      if(was){ audioEl.pause(); playing=false; }
      setTrack(trackIndex + 1);
      btnPlay.textContent = "ÿ™ÿ¥ÿ∫ŸäŸÑ";
      stopViz();
      if(was) await playPause();
    });

    function fadeTo(targetVol, ms=900){
      const start = audioEl.volume;
      const startT = performance.now();
      return new Promise(resolve=>{
        function step(t){
          const p = Math.min(1, (t-startT)/ms);
          audioEl.volume = start + (targetVol-start)*p;
          if(p<1) requestAnimationFrame(step);
          else resolve();
        }
        requestAnimationFrame(step);
      });
    }

    // ===== 11:11 BLACK FX (Hearts more + heavy snow + audio reactive) =====
    const fxWrap = document.getElementById("fx1111");
    const fxCanvas = document.getElementById("fxCanvas");
    const fxCtx = fxCanvas.getContext("2d");

    function setFxCanvasSize(){
      const dpr = window.devicePixelRatio || 1;
      fxCanvas.width  = Math.floor(window.innerWidth * dpr);
      fxCanvas.height = Math.floor(window.innerHeight * dpr);
      fxCtx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", setFxCanvasSize);
    setFxCanvasSize();

    let fxRunning = false;
    let fxRAF = null;
    let particles = [];
    let fxEndTimer = null;
    let lastSpawn = 0;

    function rand(min,max){ return Math.random()*(max-min)+min; }
    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

    function drawHeart(ctx, x, y, size){
      ctx.save();
      ctx.translate(x,y);
      ctx.beginPath();
      const s = size;
      ctx.moveTo(0, s*0.35);
      ctx.bezierCurveTo(0, 0, -s, 0, -s, s*0.35);
      ctx.bezierCurveTo(-s, s*0.85, 0, s, 0, s*1.25);
      ctx.bezierCurveTo(0, s, s, s*0.85, s, s*0.35);
      ctx.bezierCurveTo(s, 0, 0, 0, 0, s*0.35);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function getAudioIntensity(){
      if(!window.analyser || !window.freqData) return 0.22;
      window.analyser.getByteFrequencyData(window.freqData);
      let sum = 0;
      const take = Math.min(160, window.freqData.length);
      for(let i=0;i<take;i++) sum += window.freqData[i];
      return clamp((sum / take) / 255, 0, 1);
    }

    function spawnParticles(count, intensity){
      const w = window.innerWidth;
      const h = window.innerHeight;
      for(let i=0;i<count;i++){
        const isHeart = Math.random() < 0.75; // ‚ù§Ô∏è ŸÇŸÑŸàÿ® ÿ£ŸÉÿ´ÿ±
        particles.push({
          x: rand(-20,w+20),
          y: rand(-h, 0),
          r: isHeart ? rand(9,18) : rand(6,14),
          vy: isHeart ? rand(70,160) : rand(90,220), // ‚ùÑÔ∏è ÿ´ŸÑÿ¨ ÿ£ÿ´ŸÇŸÑ
          vx: rand(-26,26),
          wobble: rand(0, Math.PI*2),
          wSpeed: rand(0.9, 2.6),
          type: isHeart ? "heart" : "snow",
          a: rand(0.65, 1),
          spin: rand(-1, 1) * (0.6 + intensity*1.8)
        });
      }
    }

    function fxLoop(t){
      if(!fxRunning) return;

      const w = window.innerWidth;
      const h = window.innerHeight;

      const intensity = getAudioIntensity();       // 0..1
      const speedBoost = 1 + intensity * 2.1;      // ‚úÖ ÿ™ŸÅÿßÿπŸÑ ŸÇŸàŸä
      const driftBoost = 1 + intensity * 3.0;

      fxCtx.clearRect(0,0,w,h);
      fxCtx.fillStyle = "#000";
      fxCtx.fillRect(0,0,w,h);

      // ŸÉÿ´ÿßŸÅÿ© ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ© (ÿ´ŸÑÿ¨ ÿ´ŸÇŸäŸÑ + ŸÇŸÑŸàÿ® ŸÉÿ´Ÿäÿ±ÿ©)
      const now = performance.now();
      if(now - lastSpawn > 45){ // spawn ÿ≥ÿ±Ÿäÿπ
        lastSpawn = now;
        const extra = Math.floor(6 + intensity * 14);
        spawnParticles(extra, intensity);
      }

      // ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ŸÉÿ´ÿßŸÅÿ© ÿπÿßŸÑŸäÿ©
      const maxP = 620;
      if(particles.length > maxP) particles.splice(0, particles.length - maxP);

      for(let p of particles){
        p.wobble += 0.02 * p.wSpeed * driftBoost;

        // ÿ≠ÿ±ŸÉÿ©
        p.y += (p.vy/60) * speedBoost;
        p.x += ((p.vx/60) + Math.sin(p.wobble)*0.55) * driftBoost;

        // ŸÑŸÅŸë ÿ®ÿ≥Ÿäÿ∑
        p.spin += (intensity*0.08);

        // ÿ•ÿπÿßÿØÿ© ÿ™ÿØŸàŸäÿ±
        if(p.y > h + 50){
          p.y = rand(-160, -20);
          p.x = rand(-20,w+20);
        }
        if(p.x < -60) p.x = w + 60;
        if(p.x > w + 60) p.x = -60;

        if(p.type === "snow"){
          // ‚ùÑÔ∏è ÿ´ŸÑÿ¨ ÿ´ŸÇŸäŸÑ ŸàŸÑŸÖÿπÿ©
          const alpha = p.a * (0.55 + intensity*0.45);
          fxCtx.globalAlpha = alpha;

          fxCtx.fillStyle = "rgba(255,255,255,0.95)";
          fxCtx.beginPath();
          fxCtx.arc(p.x, p.y, p.r*0.46, 0, Math.PI*2);
          fxCtx.fill();

          fxCtx.globalAlpha = 0.12 + intensity*0.22;
          fxCtx.fillStyle = "rgba(255,255,255,1)";
          fxCtx.beginPath();
          fxCtx.arc(p.x - p.r*0.10, p.y - p.r*0.10, p.r*0.18, 0, Math.PI*2);
          fxCtx.fill();
        }else{
          // ‚ù§Ô∏è ŸÇŸÑŸàÿ® ŸÖÿπ ÿ™ŸàŸáÿ¨ ŸÇŸàŸä Ÿäÿ™ÿ∫Ÿäÿ± ŸÖÿπ ÿßŸÑÿµŸàÿ™
          const glow = 0.12 + intensity*0.45;
          fxCtx.globalAlpha = p.a * (0.70 + intensity*0.30);

          fxCtx.fillStyle = "rgba(255, 30, 80, 0.90)";
          fxCtx.shadowColor = `rgba(255, 30, 80, ${glow})`;
          fxCtx.shadowBlur = 22 + intensity*40;

          drawHeart(fxCtx, p.x, p.y, p.r);

          fxCtx.shadowBlur = 0;
          fxCtx.shadowColor = "transparent";
        }
      }

      fxCtx.globalAlpha = 1;
      fxRAF = requestAnimationFrame(fxLoop);
    }

    async function start1111FX(){
      // ÿßÿÆŸÅÿßÿ° ŸÉŸÑÿ¥Ÿä
      document.documentElement.style.overflow = "hidden";
      document.body.style.pointerEvents = "none";

      // ÿßÿ∏Ÿáÿ± overlay
      fxWrap.classList.add("show");
      fxWrap.style.pointerEvents = "auto";

      setFxCanvasSize();
      particles = [];
      lastSpawn = 0;

      // ÿ•ÿ∞ÿß ÿßŸÑÿµŸàÿ™ ÿ¥ÿ∫ÿßŸÑ: ÿ¨ŸáŸëÿ≤ ÿßŸÑÿ™ŸÅÿßÿπŸÑÿå ÿ•ÿ∞ÿß ŸÑÿß: Ÿäÿ®ŸÇŸâ ÿ™ÿ£ÿ´Ÿäÿ± ÿ´ÿßÿ®ÿ™
      try{
        ensureAudioGraph();
        if(window.audioCtx && window.audioCtx.state === "suspended"){
          // ŸÖÿß ŸÜÿ¨ÿ®ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ÿå ÿ®ÿ≥ ŸÜÿÆŸÑŸäŸáÿß ÿ¨ÿßŸáÿ≤ÿ©
          await window.audioCtx.resume().catch(()=>{});
        }
      }catch(e){}

      // ŸÉÿ´ÿßŸÅÿ© ÿπÿßŸÑŸäÿ© ÿ®ÿßŸÑÿ®ÿØÿßŸäÿ©
      const intensity = getAudioIntensity();
      spawnParticles(520, intensity);

      fxRunning = true;
      if(fxRAF) cancelAnimationFrame(fxRAF);
      fxLoop();

      // ÿ¥ŸàŸäÿ© ÿ™ŸÅÿßÿπŸÑ ÿπŸÑŸâ ÿßŸÑŸÅŸäÿØŸäŸà/overlay (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
      const video = document.querySelector(".bgVideo");
      const overlay = document.querySelector(".overlay");
      if(video) video.style.opacity = "0"; // ŸÜÿÆŸÅŸä ÿßŸÑŸÅŸäÿØŸäŸà ŸàŸÇÿ™ ÿßŸÑÿ≠ÿØÿ´
      if(overlay) overlay.style.opacity = "0";

      // ÿ¥ÿ∫ŸÑ ŸÖŸÇÿ∑ÿπ 11:11 ÿ•ÿ∞ÿß ÿ™ŸÇÿØÿ± (ŸÑÿßÿ≤ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÉÿßŸÜ ÿ∂ÿ∫ÿ∑ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÇÿ®ŸÑ)
      const oldState = { src: audioEl.src, idx: trackIndex, wasPlaying: playing, vol: audioEl.volume };
      try{
        // ŸÑŸà ŸÉÿßŸÜ ÿ¥ÿ∫ÿßŸÑÿå ŸÜÿ®ÿØŸëŸÑ ŸÑŸÑŸÖŸÇÿ∑ÿπ ÿßŸÑÿÆÿßÿµ
        if(oldState.wasPlaying){
          await fadeTo(Math.min(oldState.vol, 0.25), 700);
          audioEl.src = elevenTrack.file;
          titleEl.textContent = `üéÅ 11:11 ‚Äî ${elevenTrack.title}`;
          await audioEl.play();
          playing = true;
          btnPlay.textContent = "ÿ•ŸäŸÇÿßŸÅ";
          startViz();
        }
      }catch(e){}

      // ŸÜŸáÿßŸäÿ© ÿØŸÇŸäŸÇÿ©
      clearTimeout(fxEndTimer);
      fxEndTimer = setTimeout(async ()=>{
        fxRunning = false;
        if(fxRAF) cancelAnimationFrame(fxRAF);
        fxRAF = null;

        fxWrap.classList.remove("show");
        document.documentElement.style.overflow = "";
        document.body.style.pointerEvents = "";

        if(video) video.style.opacity = "";
        if(overlay) overlay.style.opacity = "";

        // ÿßÿ±ÿ¨ÿπ ŸÑŸÑŸÖŸÇÿ∑ÿπ ÿßŸÑÿ≥ÿßÿ®ŸÇ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ¥ÿ∫ÿßŸÑ
        try{
          if(oldState.wasPlaying){
            await fadeTo(0.18, 500);
            audioEl.src = oldState.src || tracks[oldState.idx]?.file;
            trackIndex = oldState.idx;

            await audioEl.play();
            playing = true;
            btnPlay.textContent = "ÿ•ŸäŸÇÿßŸÅ";
            titleEl.textContent = `ÿßŸÑŸÖŸÇÿ∑ÿπ: ${trackIndex + 1} ‚Äî ${tracks[trackIndex]?.title || ""}`;
            startViz();

            const sliderVol = (Number(vol.value)||70)/100;
            await fadeTo(sliderVol, 800);
          }
        }catch(e){}
      }, 60000);
    }

    // ÿ≤ÿ± ÿßŸÑŸÖÿπÿßŸäŸÜÿ©
    document.getElementById("preview1111").addEventListener("click", () => {
      start1111FX();
    });

    // ÿ™ÿ≠ŸÇŸÇ 11:11 ŸÖÿ±ÿ© ÿ®ÿßŸÑŸäŸàŸÖ
    let lastKey = null;
    function check1111(t){
      const [hh, mm] = t.split(":");
      if(hh === "11" && mm === "11"){
        const now = new Date();
        const key = new Intl.DateTimeFormat("en-CA", {
          timeZone: "Asia/Baghdad",
          year:"numeric", month:"2-digit", day:"2-digit"
        }).format(now);

        if(lastKey !== key){
          lastKey = key;
          start1111FX();
        }
      }
    }

    function tick(){
      const t = formatIraqTime();
      timeNow.textContent = t;
      timeGhost.textContent = t;
      dateTxt.textContent = formatIraqDate();
      check1111(t);
    }
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
