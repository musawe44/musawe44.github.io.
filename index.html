<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MUSAWI</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --card: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.18);
      --text: #eef2ff;
      --muted:#d1d5db;
      --shadow: 0 18px 40px rgba(0,0,0,.38);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 14px;
      overflow-x:hidden;
      background:#0b1220;
    }

    /* ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ© */
    .bgVideo{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      z-index:-3;
      filter: saturate(1.1) contrast(1.05);
      transform: scale(1.02);
    }

    /* ØªØºØ·ÙŠØ©/ØªØ¸Ù„ÙŠÙ„ Ø®ÙÙŠÙ */
    .overlay{
      position:fixed;
      inset:0;
      z-index:-2;
      background:
        radial-gradient(900px 500px at 80% 20%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(700px 450px at 20% 80%, rgba(59,130,246,.14), transparent 55%),
        linear-gradient(120deg, rgba(11,18,32,.22), rgba(11,18,32,.16));
      backdrop-filter: blur(0px);
    }

    /* ===== Cards ===== */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);

      position:relative;
      overflow:hidden;
      will-change: transform, opacity;
      transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
      animation: enter .65s ease both;
    }

    @keyframes enter {
      from { opacity: 0; transform: translateY(14px) scale(.99); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .profile{ animation-delay: .05s; }
    .youtube{ animation-delay: .15s; }
    .social{  animation-delay: .25s; }
    .pageFooter{ animation-delay: .35s; }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 200px at 20% 0%, rgba(255,255,255,.12), transparent 60%);
      opacity: 0;
      transition: opacity .25s ease;
      pointer-events:none;
    }

    .card:hover{
      transform: translateY(-4px);
      box-shadow: 0 22px 55px rgba(0,0,0,.45);
    }
    .card:hover::before{ opacity: 1; }

    .hero{
      display:flex;
      gap:16px;
      align-items:center;
    }

    .photo{
      width:92px;
      height:92px;
      border-radius:18px;
      border:1px solid var(--border);
      object-fit: cover;
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
    }

    h1{ margin:0; font-size:30px; line-height:1.15; }
    .subtitle{ margin:6px 0 0; color:var(--muted); }

    .badges{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      font-size:14px;
      color:var(--text);
      white-space:nowrap;
    }

    .section-title{
      margin:0 0 10px;
      font-size:18px;
      color:var(--text);
    }

    /* ===== Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø­ÙƒÙ…Ø©) ===== */
    .bigNote{
      margin:0;
      padding:14px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      line-height: 2.05;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: .2px;
      text-align: right;
    }
    @media (max-width: 520px){
      .bigNote{ font-size:18px; }
    }

    /* ===== Links ===== */
    .links{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .link{
      text-decoration:none;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      transition:.15s transform, .15s background;
      position:relative;
      overflow:hidden;
    }
    .link:hover{ transform: translateY(-2px); background:rgba(255,255,255,.09); }

    .link::after{
      content:"";
      position:absolute;
      top:0; bottom:0;
      left:-120%;
      width:120%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.18), transparent);
      transform: skewX(-18deg);
      transition: left .45s ease;
      pointer-events:none;
    }
    .link:hover::after{ left:120%; }

    .left{ display:flex; align-items:center; gap:10px; font-weight:700; }
    .icon{
      width:34px; height:34px;
      border-radius:10px;
      display:grid; place-items:center;
      background:rgba(255,255,255,.09);
      border:1px solid var(--border);
      font-size:16px;
    }

    /* ===== YouTube ===== */
    .video{
      margin-top:12px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid var(--border);
      background: rgba(0,0,0,.20);
      aspect-ratio: 16 / 9;
    }
    .video iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }

    /* ===== Audio Player + Visualizer ===== */
    .audioBox{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      margin-top:10px;
    }

    .trackTitle{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
      flex:1;
      text-align:right;
    }

    .audioBtn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-family:inherit;
      font-weight:800;
      white-space:nowrap;
    }
    .audioBtn:hover{ background:rgba(255,255,255,.12); }

    .navBtns{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .navBtn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-family:inherit;
      font-weight:800;
      line-height:1;
    }
    .navBtn:hover{ background:rgba(255,255,255,.12); }

    .audioRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
    }
    .volumeWrap{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
    }
    .volumeLabel{
      font-size:13px;
      color:var(--muted);
      white-space:nowrap;
    }
    .volume{
      width:100%;
      accent-color: rgba(34,197,94,.95);
    }

    .vizWrap{
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    #viz{
      width:100%;
      height:110px;
      display:block;
    }

    footer{
      text-align:center;
      color:rgba(255,255,255,.85);
      font-size:13px;
      padding:12px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:18px;
    }

    /* ===== Layout ===== */
    .gridWrap{
      width:min(980px,100%);
      position:relative;
      display:grid;
      gap:16px;

      grid-template-columns: .8fr 1.2fr;

      grid-template-areas:
        "youtube  profile"
        "social   profile"
        "footer   footer";
    }

    .profile{ grid-area: profile; }
    .youtube{ grid-area: youtube; }
    .social{ grid-area: social; }
    .pageFooter{ grid-area: footer; }

    .vDivider{
      position:absolute;
      top:14px;
      bottom:14px;
      left: 40%;
      width:1px;
      background: linear-gradient(to bottom, transparent, rgba(255,255,255,.25), transparent);
      box-shadow: 0 0 18px rgba(255,255,255,.12);
      border-radius:999px;
      pointer-events:none;
    }

    @media (max-width: 920px){
      .gridWrap{
        grid-template-columns: 1fr;
        grid-template-areas:
          "profile"
          "youtube"
          "social"
          "footer";
      }
      .vDivider{ display:none; }
    }
  </style>
</head>
/* ===== iPhone-like Top Bar ===== */
.topbar{
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: min(980px, calc(100% - 20px));
  z-index: 50;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08);
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 28px rgba(0,0,0,.25);

  font-weight: 800;
}

.topbar-left{
  display:flex;
  align-items:center;
  gap:10px;
  letter-spacing: .3px;
}

#iqTime{
  font-size: 16px;
  line-height: 1;
}

.topbar-right{
  display:flex;
  align-items:center;
  gap:10px;
}

.wx{
  display:flex;
  align-items:center;
  gap:8px;
  color: rgba(255,255,255,.92);
  font-size: 13px;
  font-weight: 700;
}

.wx-ico{
  font-size: 16px;
}

/* Ø­ØªÙ‰ Ù…Ø§ ÙŠØºØ·ÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */
body{ padding-top: 70px; }

<body>
  <!-- ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ© -->
  <video class="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>
  <!-- Top Bar -->
<div class="topbar" dir="ltr">
  <div class="topbar-left">
    <span id="iqTime">--:--</span>
  </div>

  <div class="topbar-right" dir="rtl">
    <span class="wx" id="basraWx">
      <span class="wx-ico" id="basraWxIco">â›…</span>
      <span id="basraWxTxt">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø·Ù‚Ø³ Ø§Ù„Ø¨ØµØ±Ø©...</span>
    </span>
  </div>
</div>


  <main class="gridWrap">
    <div class="vDivider"></div>

    <!-- ÙŠÙ…ÙŠÙ†: Ø§Ù„ØªØ¹Ø±ÙŠÙ -->
    <section class="card profile">
      <div class="hero">
        <img class="photo" src="avatar.jpg" alt="ØµÙˆØ±ØªÙŠ">
        <div>
          <h1>MUSAWI</h1>
          <p class="subtitle">Ø·Ø§Ù„Ø¨ GEOLOGY â€” Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¨ØµØ±Ø© | ÙƒÙ„ÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙ… â€” Ø§Ù„Ø¨ØµØ±Ø©</p>

          <div class="badges">
            <span class="badge">ğŸ“š ØªØ¹Ù„Ù‘Ù…</span>
            <span class="badge">ğŸ’» Ø®Ø¨Ø±Ø© Ø¨Ø§Ù„Ø­Ø§Ø³Ø¨Ø§Øª</span>
          </div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.14); margin:14px 0;">

      <h2 class="section-title">ÙƒÙ„Ù…Ø©</h2>

      <!-- âœ… Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙŠØ¬ÙŠ Ù…Ù† Google Sheet (B1) -->
      <p class="bigNote" id="mainQuote">... ØªØ­Ù…ÙŠÙ„</p>
    </section>

    <!-- ÙŠØ³Ø§Ø± ÙÙˆÙ‚: ÙŠÙˆØªÙŠÙˆØ¨ -->
    <section class="card youtube">
      <h2 class="section-title">ØµÙˆØ±Ø© Ù…ÙˆØ³ÙŠÙ‚Ù‰</h2>
      <div class="video">
        <iframe
          src="https://www.youtube.com/embed/BXChU6bMEXU"
          title="YouTube video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>
    </section>

    <!-- ÙŠØ³Ø§Ø± ØªØ­Øª: ØªÙˆØ§ØµÙ„ + Ù…ÙˆØ³ÙŠÙ‚Ù‰ + Ù…ÙˆØ¬Ø§Øª -->
    <aside class="card social">
      <h2 class="section-title">ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ</h2>

      <div class="audioBox">
        <div class="navBtns">
          <button class="navBtn" id="prevTrack" title="Ø§Ù„Ø³Ø§Ø¨Ù‚">â—€</button>
          <button class="navBtn" id="nextTrack" title="Ø§Ù„ØªØ§Ù„ÙŠ">â–¶</button>
        </div>
        
/* ===== Iraq Clock + Basra Weather (Free) ===== */
(function clockAndWeather(){
  // ---- Iraq clock ----
  const timeEl = document.getElementById("iqTime");
  function tick(){
    const now = new Date();
    // ÙˆÙ‚Øª Ø§Ù„Ø¹Ø±Ø§Ù‚
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone: "Asia/Baghdad",
      hour: "2-digit",
      minute: "2-digit"
    }).format(now);
    timeEl.textContent = parts;
  }
  tick();
  setInterval(tick, 1000);

  // ---- Basra weather (Open-Meteo, no key) ----
  const wxTxt = document.getElementById("basraWxTxt");
  const wxIco = document.getElementById("basraWxIco");

  // Basra coordinates
  const lat = 30.5085;
  const lon = 47.7804;

  function codeToArabic(code){
    // ØªØ¨Ø³ÙŠØ· Ù„Ù„Ø£ÙƒÙˆØ§Ø¯ (Open-Meteo WMO)
    if (code === 0) return ["â˜€ï¸","ØµØ­Ùˆ"];
    if ([1,2].includes(code)) return ["ğŸŒ¤ï¸","ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹"];
    if (code === 3) return ["â˜ï¸","ØºØ§Ø¦Ù…"];
    if ([45,48].includes(code)) return ["ğŸŒ«ï¸","Ø¶Ø¨Ø§Ø¨"];
    if ([51,53,55].includes(code)) return ["ğŸŒ¦ï¸","Ø±Ø°Ø§Ø°"];
    if ([61,63,65].includes(code)) return ["ğŸŒ§ï¸","Ù…Ø·Ø±"];
    if ([71,73,75,77].includes(code)) return ["ğŸŒ¨ï¸","Ø«Ù„Ø¬"];
    if ([80,81,82].includes(code)) return ["ğŸŒ§ï¸","Ø²Ø®Ø§Øª"];
    if ([95,96,99].includes(code)) return ["â›ˆï¸","Ø¹Ø§ØµÙØ© Ø±Ø¹Ø¯ÙŠØ©"];
    return ["â›…","Ø·Ù‚Ø³ Ù…ØªØºÙŠØ±"];
  }

  async function fetchWeather(){
    try{
      const url =
        `https://api.open-meteo.com/v1/forecast` +
        `?latitude=${lat}&longitude=${lon}` +
        `&current=temperature_2m,weather_code` +
        `&timezone=Asia%2FBaghdad`;

      const res = await fetch(url, { cache: "no-store" });
      const data = await res.json();

      const temp = Math.round(data.current.temperature_2m);
      const code = data.current.weather_code;

      const [ico, desc] = codeToArabic(code);
      wxIco.textContent = ico;
      wxTxt.textContent = `Ø§Ù„Ø¨ØµØ±Ø©: ${temp}Â° â€” ${desc}`;
    }catch(e){
      wxTxt.textContent = "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø·Ù‚Ø³ Ø§Ù„Ø¨ØµØ±Ø©";
      wxIco.textContent = "âš ï¸";
    }
  }

  fetchWeather();
  setInterval(fetchWeather, 10 * 60 * 1000); // ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
})();

        <p class="trackTitle" id="trackTitle">Ø§Ù„Ù…Ù‚Ø·Ø¹: 1</p>

        <button class="audioBtn" id="audioBtn">ØªØ´ØºÙŠÙ„</button>
      </div>

      <div class="audioRow">
        <div class="volumeWrap">
          <span class="volumeLabel">Ø®ÙØ¶ Ø§Ù„ØµÙˆØª</span>
          <input class="volume" id="volume" type="range" min="0" max="100" value="70">
        </div>
      </div>

      <div class="vizWrap">
        <canvas id="viz"></canvas>
      </div>

      <!-- Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª -->
      <audio id="bgAudio" preload="metadata" loop></audio>

      <div class="links">
        <a class="link" href="https://t.me/Mu29_iq" target="_blank" rel="noopener">
          <span class="left"><span class="icon">âœˆï¸</span>Telegram</span>
          <span>â†—</span>
        </a>

        <a class="link" href="https://www.instagram.com/mu29__/" target="_blank" rel="noopener">
          <span class="left"><span class="icon">ğŸ“¸</span>Instagram</span>
          <span>â†—</span>
        </a>
      </div>
    </aside>

    <footer class="pageFooter">
      Â© <span id="y"></span> â€” ÙÙØ¥ÙÙ†Ù‘Ù Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§
    </footer>
  </main>

  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    // ===== Google Sheet: Ù†Ù‚Ø±Ø£ B1 ÙˆÙ†Ø®Ù„ÙŠÙ‡ Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ =====
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXkdu2p1KVIjDPGdb97HfmkKa2WuvKN349Z5qdZOd_RTCyT__xNLL44swa0EUAnq614hxS9p52NSlL/pub?gid=0&single=true&output=csv";

    fetch(SHEET_CSV_URL)
      .then(res => res.text())
      .then(text => {
        text = text.replace(/^\uFEFF/, ""); // remove BOM
        const commaIndex = text.indexOf(",");
        if (commaIndex === -1) return;
        const value = text.slice(commaIndex + 1).trim().replace(/^"|"$/g, "");
        if (value) document.getElementById("mainQuote").textContent = value;
      })
      .catch(()=>{});

    // ===== Playlist (Ø¶ÙŠÙ Ù…Ù„ÙØ§Øª mp3 Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹) =====
    // IMPORTANT: Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø£Ùˆ ØºÙŠÙ‘Ø±Ù‡Ø§ Ù‡Ù†Ø§
    const tracks = [
      { title: "Ø§Ù„Ù…Ù‚Ø·Ø¹ 1", file: "audio.mp3.mp3" },  // Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø¯Ùƒ
      { title: "Ø§Ù„Ù…Ù‚Ø·Ø¹ 2", file: "track2.mp3" },     // Ø§Ø±ÙØ¹Ù‡ Ø¥Ø°Ø§ ØªØ±ÙŠØ¯Ù‡
      { title: "Ø§Ù„Ù…Ù‚Ø·Ø¹ 3", file: "track3.mp3" }      // Ø§Ø±ÙØ¹Ù‡ Ø¥Ø°Ø§ ØªØ±ÙŠØ¯Ù‡
    ];

    const audioEl = document.getElementById("bgAudio");
    const btn = document.getElementById("audioBtn");
    const vol = document.getElementById("volume");
    const titleEl = document.getElementById("trackTitle");
    const prevBtn = document.getElementById("prevTrack");
    const nextBtn = document.getElementById("nextTrack");

    const canvas = document.getElementById("viz");
    const ctx = canvas.getContext("2d");

    let audioCtx = null, analyser = null, srcNode = null, freqData = null;
    let rafId = null;
    let playing = false;
    let trackIndex = 0;

    function setTrack(i){
      trackIndex = (i + tracks.length) % tracks.length;
      const t = tracks[trackIndex];

      // Ø¥Ø°Ø§ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ØŒ Ù…Ø§ Ø±Ø§Ø­ ÙŠØ´ØªØºÙ„
      audioEl.src = t.file;
      titleEl.textContent = `Ø§Ù„Ù…Ù‚Ø·Ø¹: ${trackIndex + 1} â€” ${t.title}`;
    }

    setTrack(0);

    // Volume
    audioEl.volume = (Number(vol.value) || 70) / 100;
    vol.addEventListener("input", () => {
      audioEl.volume = (Number(vol.value) || 0) / 100;
    });

    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function ensureAudioGraph(){
      if(audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();

      // Ø£Ù†Ø³Ø¨ Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© (Ù…ÙˆØ¬Ø§Øª Ø·ÙˆÙ„ÙŠØ©)
      analyser.fftSize = 2048;
      analyser.smoothingTimeConstant = 0.82;

      freqData = new Uint8Array(analyser.frequencyBinCount);

      srcNode = audioCtx.createMediaElementSource(audioEl);
      srcNode.connect(analyser);
      analyser.connect(audioCtx.destination);
    }

    // Ø±Ø³Ù… Ø£Ø¹Ù…Ø¯Ø© (Frequency Bars)
    function drawBars(){
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;

      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "rgba(255,255,255,0.03)";
      ctx.fillRect(0,0,w,h);

      if(!analyser || !freqData){
        rafId = requestAnimationFrame(drawBars);
        return;
      }

      analyser.getByteFrequencyData(freqData);

      // Ù†Ø³ØªØ®Ø¯Ù… Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØªØ±Ø¯Ø¯Ø§Øª Ø­ØªÙ‰ Ø´ÙƒÙ„Ù‡Ø§ ÙŠØµÙŠØ± â€œÙ…ÙˆØ³ÙŠÙ‚ÙŠâ€
      const bars = 64;
      const step = Math.floor(freqData.length / bars);
      const barW = w / bars;

      for(let i=0; i<bars; i++){
        const v = freqData[i * step] / 255;        // 0..1
        const barH = Math.max(6, v * (h - 12));    // Ø§Ø±ØªÙØ§Ø¹
        const x = i * barW;
        const y = h - barH;

        // Ø¹Ù…ÙˆØ¯ Ø£Ø¨ÙŠØ¶ Ø´ÙØ§Ù
        ctx.fillStyle = "rgba(255,255,255,0.78)";
        ctx.fillRect(x + barW*0.18, y, barW*0.64, barH);
      }

      rafId = requestAnimationFrame(drawBars);
    }

    function startViz(){
      if(rafId) cancelAnimationFrame(rafId);
      drawBars();
    }

    function stopViz(){
      if(rafId) cancelAnimationFrame(rafId);
      rafId = null;
      // Ø±Ø³Ù… Ø­Ø§Ù„Ø© Ù‡Ø§Ø¯Ø¦Ø©
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "rgba(255,255,255,0.03)";
      ctx.fillRect(0,0,w,h);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    stopViz();

    async function playPause(){
      try{
        ensureAudioGraph();
        if(audioCtx.state === "suspended") await audioCtx.resume();

        if(!playing){
          await audioEl.play();
          playing = true;
          btn.textContent = "Ø¥ÙŠÙ‚Ø§Ù";
          startViz();
        }else{
          audioEl.pause();
          playing = false;
          btn.textContent = "ØªØ´ØºÙŠÙ„";
          stopViz();
        }
      }catch(e){
        btn.textContent = "Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©";
      }
    }

    btn.addEventListener("click", playPause);

    // Ø£Ø³Ù‡Ù… Ø§Ù„ØªÙ†Ù‚Ù‘Ù„
    async function changeTrack(dir){
      const wasPlaying = playing;
      if(wasPlaying){
        audioEl.pause();
        playing = false;
      }

      setTrack(trackIndex + dir);

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø´ØºÙ‘Ø§Ù„ ÙŠØ±Ø¬Ø¹ ÙŠØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      if(wasPlaying){
        await playPause(); // ÙŠØ´ØºÙ„
      }else{
        // ÙŠØ¨Ù‚Ù‰ Ù…Ø·ÙÙŠ Ø¨Ø³ Ù†Ø¬Ù‡Ø² Ø§Ù„Ù…ØµØ¯Ø±
        btn.textContent = "ØªØ´ØºÙŠÙ„";
      }
    }

    prevBtn.addEventListener("click", () => changeTrack(-1));
    nextBtn.addEventListener("click", () => changeTrack(+1));

    audioEl.addEventListener("ended", () => {
      // Ø¨Ù…Ø§ Ø£Ù† loop Ù…ÙØ¹Ù‘Ù„ØŒ ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ
      // Ø¨Ø³ ØªØ±ÙƒÙ†Ø§Ù‡ Ø§Ø­ØªÙŠØ§Ø·
    });

    /* === AUDIO REACTIVE EFFECT (DELETE THIS BLOCK TO REMOVE) START === */
    (function audioReactiveEffect(){
      const video = document.querySelector(".bgVideo");
      const overlay = document.querySelector(".overlay");

      function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

      function tick(){
        if(!analyser || !freqData){
          requestAnimationFrame(tick);
          return;
        }
        analyser.getByteFrequencyData(freqData);

        // Ø´Ø¯Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ø£ÙˆÙ„ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØªØ±Ø¯Ø¯
        let sum = 0;
        const take = 80;
        for(let i=0;i<take;i++) sum += freqData[i];
        const intensity = clamp((sum / take) / 255, 0, 1);

        if(video){
          const bright = 1 + intensity * 0.10;
          const sat = 1.1 + intensity * 0.22;
          video.style.filter = `saturate(${sat}) contrast(1.05) brightness(${bright})`;
        }
        if(overlay){
          overlay.style.opacity = String(0.92 + intensity * 0.08);
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    })();
    /* === AUDIO REACTIVE EFFECT (DELETE THIS BLOCK TO REMOVE) END === */
  </script>
</body>
</html>
