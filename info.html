<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø± â€” MUSAWI</title>
  <meta name="theme-color" content="#0b1220">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --text:#eef2ff;
      --muted:#d1d5db;
      --border: rgba(255,255,255,.18);
      --glass: rgba(255,255,255,.09);
      --glass2: rgba(255,255,255,.06);
      --shadow: 0 18px 45px rgba(0,0,0,.38);
      --accent: rgba(34,197,94,.95);
      --danger: rgba(244,63,94,.90);
    }
    body.light{
      --bg:#f4f6ff;
      --text:#0b1220;
      --muted:#334155;
      --border: rgba(0,0,0,.12);
      --glass: rgba(255,255,255,.70);
      --glass2: rgba(255,255,255,.48);
      --shadow: 0 18px 45px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      background: var(--bg);
      color: var(--text);
      overflow-x:hidden;
      padding: 16px 14px 22px;
    }

    /* ===== Background video (ONLY) ===== */
    .bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-6;
      transform: scale(1.02);
      filter: saturate(1.05) contrast(1.04) brightness(.78);
    }
    body.light .bgVideo{
      filter: saturate(1.05) contrast(1.02) brightness(1.02);
    }

    /* glass overlay */
    .overlay{
      position:fixed; inset:0;
      z-index:-5;
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.12), transparent 55%),
        linear-gradient(120deg, rgba(11,18,32,.42), rgba(11,18,32,.28));
    }
    body.light .overlay{
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.10), transparent 55%),
        linear-gradient(120deg, rgba(255,255,255,.30), rgba(255,255,255,.18));
    }

    .wrap{
      width:min(980px, 100%);
      margin: 0 auto;
    }

    /* ===== Top Bar ===== */
    .topBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
    }
    .topTitle{
      margin:0;
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-family:inherit;
      font-weight: 900;
      white-space:nowrap;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn:hover{ background: rgba(255,255,255,.14); }
    body.light .btn{
      background: rgba(0,0,0,.04);
      color: rgba(10,16,28,.88);
    }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .card{
      border-radius: 20px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHd{
      padding: 14px 16px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .cardHd h2{
      margin:0;
      font-weight: 900;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .smallMuted{
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
    }
    .cardBd{ padding: 0 16px 16px; }

    /* ===== Error box ===== */
    #errBox{
      display:none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(244,63,94,.12);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      line-height: 1.8;
    }
    body.light #errBox{
      border-color: rgba(0,0,0,.12);
      background: rgba(244,63,94,.10);
      color: rgba(10,16,28,.90);
    }

    /* ===== Weather (iPhone-like list) ===== */
    .wxHero{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    body.light .wxHero{
      border-color: rgba(0,0,0,.08);
      background: rgba(255,255,255,.55);
    }
    .wxCity{
      font-weight: 900;
      font-size: 22px;
      margin:0;
      line-height:1.1;
    }
    .wxNow{
      display:flex;
      align-items:center;
      gap: 10px;
      justify-content:flex-end;
    }
    .wxNowTemp{
      font-weight: 900;
      font-size: 40px;
      margin:0;
      line-height:1;
      letter-spacing:.2px;
    }
    .wxNowDesc{
      margin:0;
      font-weight: 900;
      color: var(--muted);
      font-size: 13px;
      text-align:right;
      line-height:1.35;
    }
    .wxList{
      list-style:none;
      margin:0;
      padding: 10px 0 0;
    }
    .wxRow{
      display:grid;
      grid-template-columns: 78px 28px 1fr 44px 44px;
      gap: 10px;
      align-items:center;
      padding: 10px 0;
      border-bottom: 1px dashed rgba(255,255,255,.18);
    }
    body.light .wxRow{ border-bottom-color: rgba(0,0,0,.12); }
    .wxRow:last-child{ border-bottom: none; }
    .wxDay{
      font-weight: 900;
      font-size: 14px;
      color: rgba(255,255,255,.92);
    }
    body.light .wxDay{ color: rgba(10,16,28,.90); }
    .wxIcon{
      font-size: 18px;
      opacity:.95;
      text-align:center;
      width:28px;
    }
    .wxBar{
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
    }
    body.light .wxBar{
      background: rgba(0,0,0,.06);
      border-color: rgba(0,0,0,.08);
    }
    .wxFill{
      position:absolute; inset:0;
      width: 50%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,220,120,.90), rgba(255,170,70,.90), rgba(255,120,120,.85));
      transform-origin: right;
    }
    .wxMin, .wxMax{
      font-weight: 900;
      font-size: 13px;
      text-align:center;
      color: rgba(255,255,255,.92);
    }
    body.light .wxMin, body.light .wxMax{ color: rgba(10,16,28,.88); }
    .wxMin{ opacity:.78; }

    /* ===== Prayer list (iPhone style) ===== */
    .plist{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      overflow:hidden;
    }
    body.light .plist{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
    }
    .prow{
      display:grid;
      grid-template-columns: 92px 1fr 26px;
      gap: 10px;
      align-items:center;
      padding: 12px 14px;
      border-bottom: 1px dashed rgba(255,255,255,.18);
    }
    body.light .prow{ border-bottom-color: rgba(0,0,0,.12); }
    .prow:last-child{ border-bottom:none; }
    .ptime{
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.3px;
    }
    .pname{
      font-weight: 900;
      font-size: 16px;
    }
    .pico{
      opacity:.65;
      text-align:center;
      font-size: 18px;
    }

    /* ===== On this day (carousel) ===== */
    .odayBox{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      overflow:hidden;
    }
    body.light .odayBox{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
    }
    .odayMedia{
      height: 180px;
      background: rgba(0,0,0,.25);
      border-bottom: 1px solid rgba(255,255,255,.10);
      position:relative;
      overflow:hidden;
    }
    body.light .odayMedia{ background: rgba(0,0,0,.06); border-bottom-color: rgba(0,0,0,.08); }
    .odayMedia img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.04) contrast(1.02);
      opacity:.92;
    }
    .odayBadge{
      position:absolute;
      top: 10px;
      right: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      font-weight: 900;
      font-size: 12px;
    }
    .odayBody{ padding: 12px 14px 14px; }
    .odayYear{
      margin:0 0 6px;
      font-weight: 900;
      font-size: 14px;
      color: var(--muted);
    }
    .odayText{
      margin:0;
      font-weight: 900;
      line-height: 1.95;
      font-size: 15px;
    }
    .odayNav{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .odayCount{
      font-weight: 900;
      color: var(--muted);
      font-size: 12px;
      white-space:nowrap;
    }

    /* ===== Dua ===== */
    .duaBox{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 14px;
      line-height: 2.0;
      font-weight: 900;
    }
    body.light .duaBox{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
    }
    .duaTitle{
      margin:0 0 8px;
      font-weight: 900;
      font-size: 14px;
      color: var(--muted);
    }
    .duaText{
      margin:0;
      font-size: 16px;
    }

    /* ===== Footer mini ===== */
    .miniRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      margin-top: 14px;
    }
    .miniRow .mini{
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
    }
  </style>
</head>

<body>
  <!-- âœ… ÙÙŠØ¯ÙŠÙˆ Ø®Ù„ÙÙŠØ© ÙÙ‚Ø· -->
  <video class="bgVideo" id="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <div class="wrap">
    <div class="topBar">
      <a class="btn" href="index.html">â†© Ø±Ø¬ÙˆØ¹</a>
      <h1 class="topTitle">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø±</h1>
      <button class="btn" id="toggleTheme">ğŸŒ™/â˜€ï¸</button>
    </div>

    <div id="errBox"></div>

    <div class="grid">
      <!-- ===== Ø§Ù„Ø·Ù‚Ø³ ===== -->
      <section class="card">
        <div class="cardHd">
          <h2>Ø·Ù‚Ø³ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ â€” Ø§Ù„Ø¨ØµØ±Ø©</h2>
          <span class="smallMuted" id="wxUpdated">... ØªØ­Ù…ÙŠÙ„</span>
        </div>

        <div class="wxHero">
          <div>
            <p class="wxCity" id="wxCity">Ø§Ù„Ø¨ØµØ±Ø©</p>
            <p class="wxNowDesc" id="wxNowDesc">... ØªØ­Ù…ÙŠÙ„</p>
          </div>

          <div class="wxNow">
            <div style="text-align:right">
              <p class="wxNowTemp" id="wxNowTemp">--Â°</p>
              <p class="wxNowDesc" id="wxNowFeels">...</p>
            </div>
          </div>
        </div>

        <div class="cardBd">
          <ul class="wxList" id="wxList"></ul>
        </div>
      </section>

      <!-- ===== Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© + Ø§Ù„Ø´Ø±ÙˆÙ‚/Ø§Ù„ØºØ±ÙˆØ¨ ===== -->
      <section class="card">
        <div class="cardHd">
          <h2>Ø§Ù„Ø´Ø±ÙˆÙ‚ ÙˆØ§Ù„ØºØ±ÙˆØ¨ + Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø¬Ø¹ÙØ±ÙŠ)</h2>
          <span class="smallMuted" id="pUpdated">... ØªØ­Ù…ÙŠÙ„</span>
        </div>
        <div class="cardBd">
          <div class="plist" id="pList">
            <!-- rows injected -->
          </div>
          <div style="margin-top:10px" class="smallMuted">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨ØµÙŠØºØ© 12 Ø³Ø§Ø¹Ø© (Øµ/Ù…).
          </div>
        </div>
      </section>

      <!-- ===== ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ===== -->
      <section class="card">
        <div class="cardHd">
          <h2>ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… (Ø­Ø¯Ø« Ø­Ù‚ÙŠÙ‚ÙŠ)</h2>
          <button class="btn" id="refreshOday">ØªØ­Ø¯ÙŠØ«</button>
        </div>
        <div class="cardBd">
          <div class="odayBox">
            <div class="odayMedia">
              <img id="odayImg" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø¯Ø«">
              <div class="odayBadge" id="odayBadge">... ØªØ­Ù…ÙŠÙ„</div>
            </div>
            <div class="odayBody">
              <p class="odayYear" id="odayYear">... ØªØ­Ù…ÙŠÙ„</p>
              <p class="odayText" id="odayText">... ØªØ­Ù…ÙŠÙ„</p>

              <div class="odayNav">
                <button class="btn" id="odayPrev">â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span class="odayCount" id="odayCount">0 / 0</span>
                <button class="btn" id="odayNext">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… ===== -->
      <section class="card">
        <div class="cardHd">
          <h2>Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</h2>
          <span class="smallMuted" id="duaDay">... ØªØ­Ù…ÙŠÙ„</span>
        </div>
        <div class="cardBd">
          <div class="duaBox">
            <p class="duaTitle" id="duaTitle">...</p>
            <p class="duaText" id="duaText">... ØªØ­Ù…ÙŠÙ„</p>
          </div>
        </div>
      </section>
    </div>

    <div class="miniRow">
      <div class="mini" id="pingTxt">Ping: ...</div>
      <div class="mini" id="updTxt">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ...</div>
      <div class="mini" id="visTxt">Ø²ÙŠØ§Ø±Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²: ...</div>
    </div>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (id) => document.getElementById(id);
    const BAGHDAD_TZ = "Asia/Baghdad";
    const lat = 30.5085, lon = 47.7804; // Basra

    function showErr(msg){
      const b = $("errBox");
      b.textContent = msg;
      b.style.display = "block";
    }
    function clearErr(){
      const b = $("errBox");
      b.textContent = "";
      b.style.display = "none";
    }

    function formatDayName(date){
      return new Intl.DateTimeFormat("ar-IQ", { weekday:"short", timeZone: BAGHDAD_TZ }).format(date);
    }

    function formatTime12h(hhmm){
      // hhmm = "05:11"
      const [hS, mS] = hhmm.split(":");
      let h = Number(hS);
      const m = Number(mS);
      const isPM = h >= 12;
      let h12 = h % 12; if(h12 === 0) h12 = 12;
      const mm = String(m).padStart(2,"0");
      return `${h12}:${mm} ${isPM ? "Ù…" : "Øµ"}`;
    }

    function weatherIcon(code){
      if (code === 0) return "â˜€ï¸";
      if ([1,2].includes(code)) return "ğŸŒ¤ï¸";
      if (code === 3) return "â˜ï¸";
      if ([45,48].includes(code)) return "ğŸŒ«ï¸";
      if ([51,53,55].includes(code)) return "ğŸŒ¦ï¸";
      if ([61,63,65].includes(code)) return "ğŸŒ§ï¸";
      if ([71,73,75,77].includes(code)) return "ğŸŒ¨ï¸";
      if ([80,81,82].includes(code)) return "ğŸŒ§ï¸";
      if ([95,96,99].includes(code)) return "â›ˆï¸";
      return "â›…";
    }

    function weatherDescAr(code){
      if (code === 0) return "ØµØ­Ùˆ";
      if (code === 1) return "ØºØ§Ø¦Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹";
      if (code === 2) return "ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹";
      if (code === 3) return "ØºØ§Ø¦Ù…";
      if ([45,48].includes(code)) return "Ø¶Ø¨Ø§Ø¨";
      if ([51,53,55].includes(code)) return "Ø±Ø°Ø§Ø°";
      if ([61,63,65].includes(code)) return "Ù…Ø·Ø±";
      if ([71,73,75,77].includes(code)) return "Ø«Ù„Ø¬";
      if ([80,81,82].includes(code)) return "Ø²Ø®Ø§Øª";
      if ([95,96,99].includes(code)) return "Ø¹Ø§ØµÙØ©";
      return "Ù…ØªØºÙŠØ±";
    }

    // ===== Theme toggle =====
    const savedTheme = localStorage.getItem("themeMode");
    if(savedTheme === "light") document.body.classList.add("light");
    $("toggleTheme").addEventListener("click", () => {
      document.body.classList.toggle("light");
      localStorage.setItem("themeMode", document.body.classList.contains("light") ? "light" : "dark");
    });

    // ===== Visitors (local device only) =====
    (function(){
      const k = "info_visits_local";
      const v = (Number(localStorage.getItem(k)) || 0) + 1;
      localStorage.setItem(k, String(v));
      $("visTxt").textContent = `Ø²ÙŠØ§Ø±Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²: ${v}`;
    })();

    // ===== Last update (page) =====
    $("updTxt").textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${document.lastModified || "â€”"}`;

    // ===== Ping =====
    (async function(){
      try{
        const t0 = performance.now();
        await fetch("index.html", { cache:"no-store" });
        const ms = Math.round(performance.now() - t0);
        $("pingTxt").textContent = `Ping: ${ms}ms`;
      }catch{
        $("pingTxt").textContent = "Ping: â€”";
      }
    })();

    // ===== Weather (Open-Meteo) =====
    async function loadWeather(){
      clearErr();
      try{
        const url =
          `https://api.open-meteo.com/v1/forecast` +
          `?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,apparent_temperature,weather_code` +
          `&daily=weather_code,temperature_2m_max,temperature_2m_min` +
          `&timezone=Asia%2FBaghdad`;

        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("WX HTTP " + res.status);
        const data = await res.json();

        const curTemp = Math.round(data.current.temperature_2m);
        const feels = Math.round(data.current.apparent_temperature);
        const code = data.current.weather_code;

        $("wxNowTemp").textContent = `${curTemp}Â°`;
        $("wxNowDesc").textContent = `${weatherDescAr(code)} ${weatherIcon(code)}`;
        $("wxNowFeels").textContent = `Ø§Ù„Ù…Ø­Ø³ÙˆØ³: ${feels}Â°`;
        $("wxUpdated").textContent = "Ù…Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¢Ù†";

        const times = data.daily.time || [];
        const tmax = data.daily.temperature_2m_max || [];
        const tmin = data.daily.temperature_2m_min || [];
        const wcodes = data.daily.weather_code || [];

        // range for bars
        const all = [];
        for(let i=0;i<times.length;i++){
          if(typeof tmin[i]==="number" && typeof tmax[i]==="number"){ all.push(tmin[i], tmax[i]); }
        }
        const gMin = Math.min(...all);
        const gMax = Math.max(...all);
        const span = Math.max(1, gMax - gMin);

        const list = $("wxList");
        list.innerHTML = "";

        const daysToShow = Math.min(10, times.length);
        for(let i=0;i<daysToShow;i++){
          const d = new Date(times[i] + "T12:00:00");
          const dayName = (i===0) ? "Ø§Ù„ÙŠÙˆÙ…" : formatDayName(d);
          const mn = Math.round(tmin[i]);
          const mx = Math.round(tmax[i]);
          const c = wcodes[i];

          const leftPct = ((mn - gMin) / span) * 100;
          const widthPct = ((mx - mn) / span) * 100;

          const li = document.createElement("li");
          li.className = "wxRow";
          li.innerHTML = `
            <div class="wxDay">${dayName}</div>
            <div class="wxIcon" title="${weatherDescAr(c)}">${weatherIcon(c)}</div>
            <div class="wxBar" aria-hidden="true">
              <div class="wxFill" style="right:${100 - (leftPct + widthPct)}%; width:${widthPct}%;"></div>
            </div>
            <div class="wxMin">${mn}Â°</div>
            <div class="wxMax">${mx}Â°</div>
          `;
          list.appendChild(li);
        }
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù‚Ø³. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª Ø«Ù… Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø©.");
        $("wxUpdated").textContent = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
      }
    }

    // ===== Prayer times (AlAdhan) â€” Jafari (approx) =====
    async function loadPrayers(){
      clearErr();
      try{
        // Basra, Iraq (Ø¬Ø¹ÙØ±ÙŠ/Ø´ÙŠØ¹ÙŠ) â€” Ù†Ø³ØªØ®Ø¯Ù… method=0 (Ø´Ø§Ø¦Ø¹ ÙƒÙ€ Shia Ithna-Ashari)
        const url = `https://api.aladhan.com/v1/timingsByCity?city=Basra&country=Iraq&method=0`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("PR HTTP " + res.status);
        const data = await res.json();
        const t = data?.data?.timings;
        if(!t) throw new Error("No timings");

        const rows = [
          { name:"ØµÙ„Ø§Ø© Ø§Ù„ØµØ¨Ø­", key:"Fajr", icon:"ğŸ””" },
          { name:"Ø§Ù„Ø´Ø±ÙˆÙ‚", key:"Sunrise", icon:"â˜€ï¸" },
          { name:"ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±", key:"Dhuhr", icon:"ğŸ””" },
          { name:"Ø§Ù„ØºØ±ÙˆØ¨", key:"Sunset", icon:"ğŸŒ‡" },
          { name:"ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨", key:"Maghrib", icon:"ğŸŒ™" },
          { name:"ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡", key:"Isha", icon:"âœ¨" }
        ];

        const list = $("pList");
        list.innerHTML = reminderRow("... ØªØ­Ù…ÙŠÙ„");

        const frag = document.createDocumentFragment();

        for(const r of rows){
          const hhmm = String(t[r.key] || "").slice(0,5);
          if(!/^\d{2}:\d{2}$/.test(hhmm)) continue;
          const div = document.createElement("div");
          div.className = "prow";
          div.innerHTML = `
            <div class="ptime">${formatTime12h(hhmm)}</div>
            <div class="pname">${r.name}</div>
            <div class="pico">${r.icon}</div>
          `;
          frag.appendChild(div);
        }

        list.innerHTML = "";
        list.appendChild(frag);

        $("pUpdated").textContent = "Ù…Ø­Ø¯Ù‘Ø« Ø§Ù„ÙŠÙˆÙ…";
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©. Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±ØŒ Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
        $("pUpdated").textContent = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
        $("pList").innerHTML = reminderRow("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
      }
    }

    function reminderRow(text){
      return `
        <div class="prow">
          <div class="ptime">--:--</div>
          <div class="pname">${text}</div>
          <div class="pico">â€¦</div>
        </div>
      `;
    }

    // ===== On This Day (Arabic Wikipedia feed + Arabic summary for image) =====
    let ODAY = { list: [], idx: 0 };

    async function loadOnThisDay(){
      clearErr();
      try{
        const now = new Date();
        const baghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
        const m = baghdad.getMonth() + 1;
        const d = baghdad.getDate();

        const url = `https://api.wikimedia.org/feed/v1/wikipedia/ar/onthisday/events/${m}/${d}`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("OnThisDay HTTP " + res.status);
        const data = await res.json();

        const events = Array.isArray(data.events) ? data.events : [];
        const cleaned = events
          .filter(e => e && e.year && e.text)
          .slice(0, 25);

        if(!cleaned.length) throw new Error("No events");

        ODAY.list = cleaned;
        ODAY.idx = 0;

        await renderOnThisDay();
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ (ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…). Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
        $("odayBadge").textContent = "ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„";
        $("odayYear").textContent = "â€”";
        $("odayText").textContent = "â€”";
        $("odayCount").textContent = "0 / 0";
        $("odayImg").src = "";
      }
    }

    async function renderOnThisDay(){
      const e = ODAY.list[ODAY.idx];
      if(!e){
        $("odayYear").textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
        $("odayText").textContent = "";
        $("odayImg").src = "";
        return;
      }

      $("odayBadge").textContent = "Ù…ØµØ¯Ø±: ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§";
      $("odayYear").textContent = `Ø³Ù†Ø© ${e.year}`;
      $("odayText").textContent = e.text;
      $("odayCount").textContent = `${ODAY.idx + 1} / ${ODAY.list.length}`;

      // image from Arabic summary
      let img = "";
      try{
        const page = e.pages?.[0];
        const title = page?.titles?.normalized || page?.titles?.display;
        if(title){
          const sUrl = `https://ar.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
          const sRes = await fetch(sUrl, { cache:"no-store" });
          if(sRes.ok){
            const sData = await sRes.json();
            img = sData?.thumbnail?.source || sData?.originalimage?.source || "";
          }
        }
      }catch{}

      if(!img){
        img = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="800" height="400">
            <defs>
              <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="rgba(255,255,255,.14)"/>
                <stop offset="1" stop-color="rgba(255,255,255,.02)"/>
              </linearGradient>
            </defs>
            <rect width="100%" height="100%" fill="url(#g)"/>
            <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle"
              fill="rgba(255,255,255,.88)" font-family="Arial" font-size="28">ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</text>
          </svg>
        `);
      }

      $("odayImg").src = img;
    }

    $("odayPrev").addEventListener("click", async () => {
      if(!ODAY.list.length) return;
      ODAY.idx = (ODAY.idx - 1 + ODAY.list.length) % ODAY.list.length;
      await renderOnThisDay();
    });
    $("odayNext").addEventListener("click", async () => {
      if(!ODAY.list.length) return;
      ODAY.idx = (ODAY.idx + 1) % ODAY.list.length;
      await renderOnThisDay();
    });
    $("refreshOday").addEventListener("click", loadOnThisDay);

    // ===== Dua of the day (2 lines only) =====
    function duaOfWeek(){
      const now = new Date();
      const baghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
      const day = baghdad.getDay(); // 0 Sun .. 6 Sat

      const names = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
      const items = [
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯", text:"Ø§Ù„Ù„Ù‡Ù… Ø§ÙØªØ­ Ù„ÙŠ Ø£Ø¨ÙˆØ§Ø¨ Ø±Ø­Ù…ØªÙƒ.\nÙˆØ§Ø¬Ø¹Ù„ ÙŠÙˆÙ…ÙŠ Ø³Ù„Ø§Ù…Ø§Ù‹ ÙˆÙ†ÙˆØ±Ø§Ù‹ ÙˆÙ‡Ø¯Ø§ÙŠØ©." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", text:"Ø§Ù„Ù„Ù‡Ù… Ù‚ÙˆÙ‘Ù Ù‚Ù„Ø¨ÙŠ Ø¹Ù„Ù‰ Ø·Ø§Ø¹ØªÙƒ.\nÙˆØ§Ø±Ø²Ù‚Ù†ÙŠ Ø±Ø²Ù‚Ø§Ù‹ Ø·ÙŠØ¨Ø§Ù‹ ÙˆØ¨Ø±ÙƒØ©Ù‹ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", text:"Ø§Ù„Ù„Ù‡Ù… Ø²Ø¯Ù†ÙŠ Ø¹Ù„Ù…Ø§Ù‹ ÙˆÙ†Ù‚Ø§Ø¡Ù‹.\nÙˆØ§ØµØ±Ù Ø¹Ù†ÙŠ Ù‡Ù…Ù‘Ø§Ù‹ Ù„Ø§ Ø£Ø·ÙŠÙ‚Ù‡." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", text:"Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†ÙŠ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±ÙŠÙ†.\nÙˆØ£Ù†Ø²Ù„ Ø§Ù„Ø³ÙƒÙŠÙ†Ø© Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ÙŠ ÙˆØ£Ù‡Ù„ÙŠ." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³", text:"Ø§Ù„Ù„Ù‡Ù… Ø·Ù‡Ù‘Ø± Ø³Ø±ÙŠØ±ØªÙŠ.\nÙˆØ§Ø¬Ø¹Ù„ Ø®ØªØ§Ù… ÙŠÙˆÙ…ÙŠ Ù…ØºÙØ±Ø© ÙˆØ±Ø¶Ø§." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©", text:"Ø§Ù„Ù„Ù‡Ù… ØµÙ„Ù‘ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯ ÙˆØ¢Ù„ Ù…Ø­Ù…Ø¯.\nÙˆØ§ØºÙØ± Ù„Ù†Ø§ ÙˆØ§Ø±Ø²Ù‚Ù†Ø§ Ø­Ø³Ù† Ø§Ù„Ø¹Ø§Ù‚Ø¨Ø©." },
        { title:"Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª", text:"Ø§Ù„Ù„Ù‡Ù… Ø§ÙƒØªØ¨ Ù„ÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø®ÙŠØ±.\nÙˆÙ‚ÙˆØ©Ù‹ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ØŒ ÙˆØ±Ø§Ø­Ø©Ù‹ ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨." }
      ];

      $("duaDay").textContent = `Ø§Ù„ÙŠÙˆÙ…: ${names[day]}`;
      $("duaTitle").textContent = items[day].title;
      $("duaText").textContent = items[day].text;
    }

    // ===== Init =====
    (async function init(){
      duaOfWeek();
      await Promise.all([
        loadWeather(),
        loadPrayers(),
        loadOnThisDay()
      ]);
    })();
  </script>
</body>
</html>