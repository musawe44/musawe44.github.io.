<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø±</title>
  <meta name="theme-color" content="#0b1220">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --text:#eef2ff;
      --muted:#cbd5e1;
      --border: rgba(255,255,255,.18);
      --glass: rgba(255,255,255,.09);
      --glass2: rgba(255,255,255,.06);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --accent: rgba(59,130,246,.92);
      --ok: rgba(34,197,94,.95);
      --warn: rgba(245,158,11,.95);
      --bad: rgba(244,63,94,.95);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      color:var(--text);
      background: var(--bg);
      overflow-x:hidden;
      padding: 16px 14px 22px;
    }

    /* ===== Video background only ===== */
    .bgVideo{
      position: fixed;
      top:0; left:0;
      width:100vw; height:100vh;
      object-fit:cover;
      z-index:-10;
      transform: scale(1.02);
      filter: saturate(1.06) contrast(1.05) brightness(.62);
    }
    .overlay{
      position: fixed;
      inset: 0;
      z-index:-5;
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.12), transparent 55%),
        linear-gradient(120deg, rgba(11,18,32,.72), rgba(11,18,32,.58));
      backdrop-filter: blur(2px);
    }

    /* ===== Layout ===== */
    .wrap{
      width:min(980px, 100%);
      margin: 0 auto;
      display:grid;
      gap:14px;
    }

    /* ===== Glass cards ===== */
    .card{
      border: 1px solid var(--border);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position: relative;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 220px at 30% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(520px 220px at 80% 70%, rgba(255,255,255,.08), transparent 65%);
      pointer-events:none;
      opacity:.85;
    }
    .card > *{ position:relative; }

    .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px 16px;
    }
    .title{
      margin:0;
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
    }
    .btn{
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      padding: 10px 14px;
      border-radius: 16px;
      font-family: inherit;
      font-weight: 900;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.14); }
    .btn.small{ padding: 8px 12px; border-radius: 14px; font-size: 13px; }

    .body{
      padding: 0 16px 16px;
    }

    .errBox{
      display:none;
      margin: 12px 16px 16px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(244,63,94,.12);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      line-height: 1.9;
    }

    /* ===== Weather (iPhone-ish list) ===== */
    .wxTop{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding: 0 16px 12px;
    }
    .wxCity{
      font-size: 18px;
      font-weight: 900;
      margin:0;
      letter-spacing:.2px;
    }
    .wxNow{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 900;
      color: rgba(255,255,255,.95);
    }
    .wxNow .big{
      font-size: 34px;
      line-height:1;
    }
    .wxNow .desc{
      font-size: 13px;
      color: var(--muted);
      margin-top:6px;
    }
    .wxNowIcon{
      width: 44px; height:44px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      font-size: 22px;
    }

    .wxList{
      padding: 6px 10px 12px;
    }
    .wxRow{
      display:grid;
      grid-template-columns: 88px 34px 1fr 48px 48px;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 18px;
    }
    .wxRow + .wxRow{ margin-top: 6px; }
    .wxRow:hover{ background: rgba(255,255,255,.06); }

    .wxDay{
      font-weight: 900;
      color: rgba(255,255,255,.95);
      white-space:nowrap;
    }
    .wxIcon{
      width: 34px; height:34px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      font-size: 18px;
    }
    .wxBar{
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }
    .wxBar > i{
      display:block;
      height:100%;
      width: 50%;
      background: linear-gradient(90deg, rgba(245,158,11,.95), rgba(34,197,94,.92));
      border-radius: 999px;
    }
    .wxMin, .wxMax{
      font-weight: 900;
      text-align:center;
      color: rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .wxMin{ opacity:.72; }

    .wxMeta{
      padding: 0 16px 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .pill{
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      color: rgba(255,255,255,.92);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill .k{ color: var(--muted); font-size: 13px; }
    .pill .v{ font-size: 13px; }

    /* ===== Prayer list (iOS modal-ish) ===== */
    .prayList{
      padding: 10px 10px 14px;
    }
    .prayRow{
      display:grid;
      grid-template-columns: 92px 1fr 40px;
      align-items:center;
      gap:10px;
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .prayRow + .prayRow{ margin-top: 8px; }
    .prayTime{
      font-weight: 900;
      font-size: 16px;
      white-space:nowrap;
      color: rgba(255,255,255,.95);
    }
    .prayName{
      font-weight: 900;
      font-size: 16px;
      color: rgba(255,255,255,.95);
    }
    .prayIco{
      width: 38px; height:38px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 18px;
      opacity: .95;
    }

    /* ===== On this day ===== */
    .odayBox{
      padding: 10px 16px 16px;
    }
    .odayCard{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 20px;
      overflow:hidden;
      display:grid;
      grid-template-columns: 110px 1fr;
      min-height: 96px;
    }
    .odayImg{
      width:100%;
      height:100%;
      object-fit:cover;
      background: rgba(255,255,255,.06);
    }
    .odayInfo{
      padding: 12px 12px 10px;
    }
    .odayYear{
      font-weight: 900;
      color: rgba(255,255,255,.85);
      font-size: 13px;
      margin:0 0 6px;
    }
    .odayText{
      margin:0;
      font-weight: 900;
      font-size: 14px;
      line-height: 1.8;
      color: rgba(255,255,255,.95);
      max-height: 3.6em;
      overflow:hidden;
    }
    .odayNav{
      margin-top: 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .odayCount{
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
      white-space:nowrap;
    }

    /* ===== Dua ===== */
    .duaBox{
      padding: 10px 16px 16px;
    }
    .duaText{
      margin:0;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      line-height: 2.0;
      color: rgba(255,255,255,.95);
      font-size: 15px;
    }
    .duaHint{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }

    /* Footer small */
    .foot{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 16px 14px;
      color: rgba(255,255,255,.82);
      font-weight: 900;
      font-size: 13px;
    }

    @media (max-width: 560px){
      .wxRow{ grid-template-columns: 78px 34px 1fr 42px 42px; }
      .wxDay{ font-size: 13px; }
      .prayTime,.prayName{ font-size: 15px; }
      .odayCard{ grid-template-columns: 98px 1fr; }
    }
  </style>
</head>

<body>
  <!-- Background video only -->
  <video class="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <div class="wrap">

    <!-- Header -->
    <section class="card">
      <div class="head">
        <div>
          <h1 class="title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø±</h1>
          <p class="sub" id="topSub">... ØªØ­Ù…ÙŠÙ„</p>
        </div>
        <a class="btn" href="index.html">Ø±Ø¬ÙˆØ¹</a>
      </div>

      <div id="errBox" class="errBox"></div>

      <div class="foot">
        <span id="pingTxt">Ping: ...</span>
        <span id="updatedTxt">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ...</span>
      </div>
    </section>

    <!-- Weather -->
    <section class="card" id="wxCard">
      <div class="head">
        <div>
          <h2 class="title">Ø·Ù‚Ø³ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ â€” Ø§Ù„Ø¨ØµØ±Ø©</h2>
          <p class="sub">Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ + Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª + Ø®Ø· Ø­Ø±Ø§Ø±Ø©</p>
        </div>
        <button class="btn small" id="refreshWx">ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="wxTop">
        <div>
          <p class="wxCity" id="wxCity">Ø§Ù„Ø¨ØµØ±Ø©</p>
          <p class="sub" id="wxDate">...</p>
        </div>
        <div class="wxNow">
          <div class="wxNowIcon" id="wxNowIcon">â›…</div>
          <div>
            <div class="big" id="wxNowTemp">--Â°</div>
            <div class="desc" id="wxNowDesc">... ØªØ­Ù…ÙŠÙ„</div>
          </div>
        </div>
      </div>

      <div class="wxList" id="wxList"></div>

      <div class="wxMeta" id="sunMeta">
        <div class="pill"><span class="k">Ø§Ù„Ø´Ø±ÙˆÙ‚</span><span class="v" id="sunriseTxt">--:--</span></div>
        <div class="pill"><span class="k">Ø§Ù„ØºØ±ÙˆØ¨</span><span class="v" id="sunsetTxt">--:--</span></div>
      </div>
    </section>

    <!-- Prayer times -->
    <section class="card" id="prayCard">
      <div class="head">
        <div>
          <h2 class="title">Ø§Ù„Ø´Ø±ÙˆÙ‚ ÙˆØ§Ù„ØºØ±ÙˆØ¨ + Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø¬Ø¹ÙØ±ÙŠ)</h2>
          <p class="sub">Ø¨Ù†Ø¸Ø§Ù… 12 Ø³Ø§Ø¹Ø© ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡</p>
        </div>
        <button class="btn small" id="refreshPray">ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="prayList" id="prayList"></div>
    </section>

    <!-- On this day -->
    <section class="card" id="odayCard">
      <div class="head">
        <div>
          <h2 class="title">ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… (Ø­Ø¯Ø« Ø­Ù‚ÙŠÙ‚ÙŠ)</h2>
          <p class="sub">ØªØµÙØ­ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ø¹ ØµÙˆØ±Ø© + Ø³Ù†Ø©</p>
        </div>
        <button class="btn small" id="refreshOday">ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="odayBox">
        <div class="odayCard">
          <img class="odayImg" id="odayImg" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø¯Ø«" src="" />
          <div class="odayInfo">
            <p class="odayYear" id="odayYear">... ØªØ­Ù…ÙŠÙ„</p>
            <p class="odayText" id="odayText">... ØªØ­Ù…ÙŠÙ„</p>
            <div class="odayNav">
              <button class="btn small" id="odayPrev">â—€</button>
              <span class="odayCount" id="odayCount">...</span>
              <button class="btn small" id="odayNext">â–¶</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Dua of day -->
    <section class="card" id="duaCard">
      <div class="head">
        <div>
          <h2 class="title">Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</h2>
          <p class="sub">Ø³Ø·Ø±ÙŠÙ† ÙÙ‚Ø· (ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…)</p>
        </div>
        <button class="btn small" id="refreshDua">ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="duaBox">
        <p class="duaText" id="duaText">... ØªØ­Ù…ÙŠÙ„</p>
        <div class="duaHint" id="duaHint">...</div>
      </div>
    </section>

  </div>

  <script>
    // ========= Helpers =========
    const $ = (id) => document.getElementById(id);
    const errBox = $("errBox");

    function showErr(msg){
      errBox.style.display = "block";
      errBox.textContent = msg;
    }
    function clearErr(){
      errBox.style.display = "none";
      errBox.textContent = "";
    }

    const BAGHDAD_TZ = "Asia/Baghdad";
    const lat = 30.5085, lon = 47.7804; // Basra

    function fmtDateAr(d){
      return new Intl.DateTimeFormat("ar-IQ", {
        timeZone: BAGHDAD_TZ,
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric"
      }).format(d);
    }

    function fmt12hFromHHMM(hhmm){
      // "17:49" -> "5:49 Ù…"
      const [hStr,mStr] = hhmm.split(":");
      let h = Number(hStr);
      const m = Number(mStr);
      const am = h < 12;
      h = h % 12; if (h === 0) h = 12;
      const mm = String(m).padStart(2,"0");
      return `${h}:${mm} ${am ? "Øµ" : "Ù…"}`;
    }

    function wmoToIconDesc(code){
      // WMO weather code mapping (Ù…Ø®ØªØµØ±)
      if (code === 0) return ["â˜€ï¸","ØµØ­Ùˆ"];
      if ([1,2].includes(code)) return ["ğŸŒ¤ï¸","ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠØ§Ù‹"];
      if (code === 3) return ["â˜ï¸","ØºØ§Ø¦Ù…"];
      if ([45,48].includes(code)) return ["ğŸŒ«ï¸","Ø¶Ø¨Ø§Ø¨"];
      if ([51,53,55].includes(code)) return ["ğŸŒ¦ï¸","Ø±Ø°Ø§Ø°"];
      if ([61,63,65].includes(code)) return ["ğŸŒ§ï¸","Ù…Ø·Ø±"];
      if ([71,73,75,77].includes(code)) return ["ğŸŒ¨ï¸","Ø«Ù„Ø¬"];
      if ([80,81,82].includes(code)) return ["ğŸŒ§ï¸","Ø²Ø®Ø§Øª"];
      if ([95,96,99].includes(code)) return ["â›ˆï¸","Ø¹Ø§ØµÙØ©"];
      return ["â›…","Ù…ØªØºÙŠØ±"];
    }

    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

    // ========= Top small status =========
    (function initTop(){
      $("topSub").textContent = fmtDateAr(new Date());
      $("updatedTxt").textContent = "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ...";
      // Ping Ø¨Ø³ÙŠØ· (ØªÙ‚Ø±ÙŠØ¨ÙŠ) Ø¹Ø¨Ø± Ù‚ÙŠØ§Ø³ fetch
      pingOnce();
      setInterval(pingOnce, 60*1000);
    })();

    async function pingOnce(){
      const t0 = performance.now();
      try{
        // Ø·Ù„Ø¨ Ø®ÙÙŠÙ
        await fetch("https://www.google.com/generate_204", { mode:"no-cors", cache:"no-store" });
        const ms = Math.round(performance.now() - t0);
        $("pingTxt").textContent = `Ping: ${ms}ms`;
      }catch{
        $("pingTxt").textContent = `Ping: --`;
      }
    }

    // ========= Weather (Open-Meteo) =========
    async function loadWeather(){
      clearErr();
      const t0 = performance.now();
      try{
        const url =
          `https://api.open-meteo.com/v1/forecast` +
          `?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,weather_code` +
          `&daily=temperature_2m_max,temperature_2m_min,weather_code,sunrise,sunset` +
          `&timezone=Asia%2FBaghdad`;

        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("Weather HTTP " + res.status);
        const data = await res.json();

        const nowTemp = Math.round(data.current.temperature_2m);
        const wcode = data.current.weather_code;
        const [ico, desc] = wmoToIconDesc(wcode);

        $("wxNowTemp").textContent = `${nowTemp}Â°`;
        $("wxNowIcon").textContent = ico;
        $("wxNowDesc").textContent = desc;
        $("wxDate").textContent = fmtDateAr(new Date());

        // sunrise/sunset (today)
        const sr = data.daily.sunrise?.[0];
        const ss = data.daily.sunset?.[0];
        if (sr) $("sunriseTxt").textContent = fmt12hFromHHMM(sr.slice(11,16));
        if (ss) $("sunsetTxt").textContent = fmt12hFromHHMM(ss.slice(11,16));

        // weekly list
        const days = data.daily.time;
        const maxs = data.daily.temperature_2m_max;
        const mins = data.daily.temperature_2m_min;
        const codes = data.daily.weather_code;

        // range for bars
        const globalMin = Math.min(...mins);
        const globalMax = Math.max(...maxs);
        const range = Math.max(1, globalMax - globalMin);

        const list = $("wxList");
        list.innerHTML = "";

        for(let i=0;i<days.length;i++){
          const d = new Date(days[i] + "T00:00:00");
          const dayName = new Intl.DateTimeFormat("ar-IQ", { timeZone:BAGHDAD_TZ, weekday:"long" }).format(d);
          const min = Math.round(mins[i]);
          const max = Math.round(maxs[i]);
          const [ic] = wmoToIconDesc(codes[i]);

          const startPct = ((min - globalMin)/range) * 100;
          const widthPct = ((max - min)/range) * 100;

          const row = document.createElement("div");
          row.className = "wxRow";
          row.innerHTML = `
            <div class="wxDay">${i===0 ? "Ø§Ù„ÙŠÙˆÙ…" : dayName}</div>
            <div class="wxIcon">${ic}</div>
            <div class="wxBar"><i style="margin-right:${startPct}%; width:${clamp(widthPct,10,100)}%"></i></div>
            <div class="wxMin">${min}Â°</div>
            <div class="wxMax">${max}Â°</div>
          `;
          list.appendChild(row);
        }

        $("updatedTxt").textContent = "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: " + new Date().toLocaleTimeString("ar-IQ");
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù‚Ø³. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
      }finally{
        // nothing
      }
    }

    $("refreshWx").addEventListener("click", loadWeather);

    // ========= Prayer times (Aladhan, Jafari) =========
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Aladhan ÙŠØ¹Ø·ÙŠ Ø£ÙˆÙ‚Ø§ØªØŒ Ù†Ø¹Ø±Ø¶Ù‡Ø§ 12 Ø³Ø§Ø¹Ø©.
    async function loadPrayer(){
      clearErr();
      try{
        const today = new Date();
        const dd = String(today.getDate()).padStart(2,"0");
        const mm = String(today.getMonth()+1).padStart(2,"0");
        const yyyy = today.getFullYear();

        // method=0 (Shia Ithna-Ashari / Jafari) Ø­Ø³Ø¨ Aladhan
        const url = `https://api.aladhan.com/v1/timings/${dd}-${mm}-${yyyy}?latitude=${lat}&longitude=${lon}&method=0&tune=0,0,0,0,0,0,0,0,0`;

        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("Prayer HTTP " + res.status);
        const data = await res.json();
        const t = data.data.timings;

        // Ù†Ø®ØªØ§Ø± Ø£Ù‡Ù… Ø§Ù„Ø£ÙˆÙ‚Ø§Øª + Ø´Ø±ÙˆÙ‚/ØºØ±ÙˆØ¨
        const items = [
          { name:"ØµÙ„Ø§Ø© Ø§Ù„ØµØ¨Ø­", time: t.Fajr, ico:"ğŸ””" },
          { name:"Ø§Ù„Ø´Ø±ÙˆÙ‚", time: t.Sunrise, ico:"â˜€ï¸" },
          { name:"ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±", time: t.Dhuhr, ico:"ğŸ””" },
          { name:"Ø§Ù„ØºØ±ÙˆØ¨", time: t.Sunset, ico:"ğŸŒ‡" },
          { name:"ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨", time: t.Maghrib, ico:"ğŸ””" },
          { name:"Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„", time: t.Midnight || t.MiddleOfTheNight, ico:"âœ¨" },
        ];

        const list = $("prayList");
        list.innerHTML = "";

        for(const it of items){
          const hhmm = String(it.time || "--:--").slice(0,5);
          const nice = (hhmm.includes(":") && hhmm !== "--:--") ? fmt12hFromHHMM(hhmm) : "--:--";
          const row = document.createElement("div");
          row.className = "prayRow";
          row.innerHTML = `
            <div class="prayTime">${nice}</div>
            <div class="prayName">${it.name}</div>
            <div class="prayIco">${it.ico}</div>
          `;
          list.appendChild(row);
        }
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©. Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
      }
    }

    $("refreshPray").addEventListener("click", loadPrayer);

    // ========= On This Day (Wikipedia / Wikimedia REST) =========
    // Ù†Ø¬ÙŠØ¨ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙŠÙˆÙ… + Ù†Ø¬ÙŠØ¨ ØµÙˆØ±Ø© Ù„Ù„Ø­Ø¯Ø« Ø¹Ø¨Ø± summary endpoint
    let ODAY = { list: [], idx: 0 };

    async function loadOnThisDay(){
      clearErr();
      try{
        const now = new Date();
        // Ø§Ù„Ø´Ù‡Ø±/Ø§Ù„ÙŠÙˆÙ… Ø­Ø³Ø¨ Ø¨ØºØ¯Ø§Ø¯ (ØªÙ‚Ø±ÙŠØ¨ÙŠØ§Ù‹)
        const baghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
        const m = baghdad.getMonth() + 1;
        const d = baghdad.getDate();

        const url = `https://api.wikimedia.org/feed/v1/wikipedia/en/onthisday/events/${m}/${d}`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("OnThisDay HTTP " + res.status);
        const data = await res.json();

        const events = Array.isArray(data.events) ? data.events : [];
        // Ù†Ù†Ø¸Ù ÙˆÙ†Ø®ØªØ§Ø± Ø£Ø­Ø¯Ø§Ø« Ø¨Ù‡Ø§ Ù†Øµ
        const cleaned = events
          .filter(e => e && e.year && e.text)
          .slice(0, 25);

        if(!cleaned.length) throw new Error("No events");

        ODAY.list = cleaned;
        ODAY.idx = 0;

        await renderOnThisDay();
      }catch(e){
        showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ (ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…). Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
      }
    }

    async function renderOnThisDay(){
      const e = ODAY.list[ODAY.idx];
      if(!e){
        $("odayYear").textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
        $("odayText").textContent = "";
        $("odayImg").src = "";
        return;
      }

      $("odayYear").textContent = `Ø³Ù†Ø© ${e.year}`;
      $("odayText").textContent = e.text;
      $("odayCount").textContent = `${ODAY.idx + 1} / ${ODAY.list.length}`;

      // ØµÙˆØ±Ø©: Ù†Ø­Ø§ÙˆÙ„ Ù†Ø¬ÙŠØ¨ ØµÙˆØ±Ø© Ù…Ù† Ø£ÙˆÙ„ ØµÙØ­Ø© Ù…Ø±ØªØ¨Ø·Ø©
      let img = "";
      try{
        const page = e.pages?.[0];
        if(page?.titles?.normalized){
          const title = page.titles.normalized;
          const sUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
          const sRes = await fetch(sUrl, { cache:"no-store" });
          if(sRes.ok){
            const sData = await sRes.json();
            img = sData?.thumbnail?.source || sData?.originalimage?.source || "";
          }
        }
      }catch{}

      if(!img){
        // fallback Ø¨Ø³ÙŠØ·Ø©
        img = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="400" height="400">
            <defs>
              <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="rgba(255,255,255,.12)"/>
                <stop offset="1" stop-color="rgba(255,255,255,.02)"/>
              </linearGradient>
            </defs>
            <rect width="100%" height="100%" fill="url(#g)"/>
            <text x="50%" y="52%" dominant-baseline="middle" text-anchor="middle"
              fill="rgba(255,255,255,.82)" font-family="Arial" font-size="26">On This Day</text>
          </svg>
        `);
      }
      $("odayImg").src = img;
    }

    $("odayPrev").addEventListener("click", async () => {
      if(!ODAY.list.length) return;
      ODAY.idx = (ODAY.idx - 1 + ODAY.list.length) % ODAY.list.length;
      await renderOnThisDay();
    });
    $("odayNext").addEventListener("click", async () => {
      if(!ODAY.list.length) return;
      ODAY.idx = (ODAY.idx + 1) % ODAY.list.length;
      await renderOnThisDay();
    });
    $("refreshOday").addEventListener("click", loadOnThisDay);

    // ========= Dua of Day (Ø³Ø·Ø±ÙŠÙ†) =========
    const DUAS = [
      { day: 0, name:"Ø§Ù„Ø£Ø­Ø¯", text:"Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†ÙŠ ÙÙŠ Ø¯Ø±Ø¹Ùƒ Ø§Ù„Ø­ØµÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØ¬Ø¹Ù„ ÙÙŠÙ‡Ø§ Ù…Ù† ØªØ±ÙŠØ¯.", text2:"ÙˆØ§Ø±Ø²Ù‚Ù†ÙŠ Ø·Ù…Ø£Ù†ÙŠÙ†Ø© ØªÙØ´Ø¨Ù‡ Ù†ÙˆØ± Ø§Ù„ØµØ¨Ø§Ø­." },
      { day: 1, name:"Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", text:"Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†ÙŠ ØªÙˆÙÙŠÙ‚Ø§Ù‹ ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø®ÙŠØ± Ø­ÙŠØ«Ù…Ø§ Ø§ØªØ¬Ù‡Øª.", text2:"ÙˆØ§Ø¬Ø¹Ù„ Ù„ÙŠ Ù…Ù† ÙƒÙ„ Ù‡Ù…Ù ÙØ±Ø¬Ø§Ù‹." },
      { day: 2, name:"Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", text:"Ø§Ù„Ù„Ù‡Ù… Ø«Ø¨Øª Ù‚Ù„Ø¨ÙŠ Ø¹Ù„Ù‰ Ù…Ø§ ØªØ­Ø¨ØŒ ÙˆØ§ØµØ±Ù Ø¹Ù†ÙŠ Ù…Ø§ ÙŠØ¶Ø±.", text2:"ÙˆØ§ØºÙ…Ø± Ø£ÙŠØ§Ù…ÙŠ Ø¨Ø±Ø­Ù…Ø©Ù Ù„Ø§ ØªÙ†Ù‚Ø·Ø¹." },
      { day: 3, name:"Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", text:"Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†ÙŠ Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„Ø³ÙƒÙŠÙ†Ø©ØŒ ÙˆÙ„Ø§ ØªÙƒÙ„Ù†ÙŠ Ù„Ù†ÙØ³ÙŠ Ø·Ø±ÙØ© Ø¹ÙŠÙ†.", text2:"ÙˆØ§ÙƒØªØ¨ Ù„ÙŠ Ø±Ø²Ù‚Ø§Ù‹ ÙŠØ·Ù…Ø¦Ù† Ù„Ù‡ Ù‚Ù„Ø¨ÙŠ." },
      { day: 4, name:"Ø§Ù„Ø®Ù…ÙŠØ³", text:"Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ø®Ø§ØªÙ…ØªÙŠ Ø®ÙŠØ±Ø§Ù‹ØŒ ÙˆØ§ØºÙØ± Ù„ÙŠ Ù…Ø§ ØªÙ‚Ø¯Ù… ÙˆÙ…Ø§ ØªØ£Ø®Ø±.", text2:"ÙˆØ§Ø±Ø²Ù‚Ù†ÙŠ Ø¯Ø¹ÙˆØ©Ù‹ Ù…Ø³ØªØ¬Ø§Ø¨Ø©." },
      { day: 5, name:"Ø§Ù„Ø¬Ù…Ø¹Ø©", text:"Ø§Ù„Ù„Ù‡Ù… ØµÙ„Ù‘ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯ ÙˆØ¢Ù„ Ù…Ø­Ù…Ø¯ØŒ ÙˆØ§Ù…Ù„Ø£ Ù‚Ù„Ø¨ÙŠ Ù†ÙˆØ±Ø§Ù‹.", text2:"ÙˆØ§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¯Ø§ÙŠØ© Ø®ÙŠØ±Ù Ù„ÙŠ ÙˆÙ„Ø£Ù‡Ù„ÙŠ." },
      { day: 6, name:"Ø§Ù„Ø³Ø¨Øª", text:"Ø§Ù„Ù„Ù‡Ù… Ø§ÙØªØ­ Ù„ÙŠ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø±Ø­Ù…Ø©ØŒ ÙˆØ£Ø¨Ø¹Ø¯ Ø¹Ù†ÙŠ ÙƒÙ„ Ø¶ÙŠÙ‚.", text2:"ÙˆØ§Ø¬Ø¹Ù„ Ù„ÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø© Ø³Ù„Ø§Ù…Ø§Ù‹." },
    ];

    function loadDua(){
      const now = new Date();
      const baghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
      const d = baghdad.getDay(); // 0=Sun
      const dua = DUAS.find(x=>x.day===d) || DUAS[0];
      $("duaText").textContent = `${dua.text}\n${dua.text2}`;
      $("duaHint").textContent = `Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… ${dua.name} â€” (Ù…Ø®ØªØµØ± Ø³Ø·Ø±ÙŠÙ†)`;
    }
    $("refreshDua").addEventListener("click", loadDua);

    // ========= Boot =========
    (async function boot(){
      loadDua();
      await Promise.allSettled([ loadWeather(), loadPrayer(), loadOnThisDay() ]);
    })();
  </script>
</body>
</html>