<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ ÙˆØ§Ù„Ø¥ÙØ·Ø§Ø± + Ø§Ù„Ø£Ø°Ø§Ù†</title>
  <meta name="theme-color" content="#0b1220">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --text:#eef2ff;
      --muted:#d1d5db;
      --border: rgba(255,255,255,.18);
      --glass: rgba(255,255,255,.09);
      --shadow: 0 18px 45px rgba(0,0,0,.38);
      --accent: rgba(34,197,94,.95);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      color:var(--text);
      background: var(--bg);
      overflow-x:hidden;
      padding: 16px 14px 22px;
    }

    /* ÙÙŠØ¯ÙŠÙˆ Ø®Ù„ÙÙŠØ© ÙÙ‚Ø· */
    .bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-6;
      transform: scale(1.02);
      filter: saturate(1.06) contrast(1.05) brightness(.62);
    }
    .overlay{
      position:fixed; inset:0;
      z-index:-5;
      background:
        radial-gradient(900px 520px at 80% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(750px 450px at 20% 80%, rgba(59,130,246,.12), transparent 55%),
        linear-gradient(120deg, rgba(11,18,32,.62), rgba(11,18,32,.42));
    }

    .wrap{ width:min(980px, 100%); margin: 0 auto; display:grid; gap:14px; }

    .card{
      border-radius: 20px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .head{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .title{ margin:0; font-weight:900; font-size:18px; }
    .sub{ margin:0; color:var(--muted); font-weight:900; font-size:12px; }

    .btn{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-family:inherit;
      font-weight: 900;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.14); }

    .body{ padding: 14px 16px 16px; }

    .bigTimes{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media(max-width:560px){ .bigTimes{ grid-template-columns: 1fr; } }

    .tile{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      padding: 14px;
    }
    .tile .k{ color:var(--muted); font-weight:900; font-size:12px; }
    .tile .v{ font-weight:900; font-size:32px; margin-top:6px; letter-spacing:.3px; }
    .tile .n{ color:rgba(255,255,255,.92); font-weight:900; font-size:14px; margin-top:6px; }

    .list{
      margin-top: 12px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px dashed rgba(255,255,255,.18);
      font-weight:900;
    }
    .row:last-child{ border-bottom:none; }
    .row .name{ opacity:.95; }
    .row .time{ opacity:.95; }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      line-height: 1.8;
    }

    .err{
      display:none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(244,63,94,.12);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      line-height: 1.8;
    }
  </style>
</head>

<body>
  <video class="bgVideo" autoplay muted loop playsinline>
    <source src="bg.mp4.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <div class="wrap">

    <section class="card">
      <div class="head">
        <div>
          <h1 class="title">â˜¾ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ ÙˆØ§Ù„Ø¥ÙØ·Ø§Ø± + Ø§Ù„Ø£Ø°Ø§Ù†</h1>
          <p class="sub" id="topSub">... ØªØ­Ù…ÙŠÙ„</p>
        </div>
        <a class="btn" href="index.html">â†© Ø±Ø¬ÙˆØ¹</a>
      </div>

      <div class="body">
        <div id="errBox" class="err"></div>

        <div class="bigTimes">
          <div class="tile">
            <div class="k">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø­ÙˆØ±)</div>
            <div class="v" id="imsakT">--:--</div>
            <div class="n" id="imsakN">...</div>
          </div>

          <div class="tile">
            <div class="k">Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø§Ù„Ù…ØºØ±Ø¨)</div>
            <div class="v" id="iftarT">--:--</div>
            <div class="n" id="iftarN">...</div>
          </div>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="enableAdhan">ğŸ”Š ØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†</button>
          <button class="btn" id="refreshBtn">âŸ³ ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <div class="list" id="prayList"></div>

        <div class="hint">
          â€¢ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¨ØµØ±Ø© (Ø¬Ø¹ÙØ±ÙŠ/Ø´ÙŠØ¹ÙŠ) Ù…Ù† API. <br>
          â€¢ Ø§Ù„Ù…ØªØµÙØ­ ÙŠÙ…Ù†Ø¹ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¶ØºØ· â€œØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†â€ Ù…Ø±Ø© ÙˆØ­Ø¯Ø©.
        </div>
      </div>
    </section>

  </div>

  <!-- Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù† -->
  <audio id="adhanAudio" src="adhan.mp3.mp3" preload="auto"></audio>

  <script>
    const BAGHDAD_TZ = "Asia/Baghdad";
    const CITY = "Basra";
    const COUNTRY = "Iraq";

    const $ = (id)=>document.getElementById(id);
    const errBox = $("errBox");
    const adhanAudio = $("adhanAudio");

    let adhanEnabled = false;
    let timesHHMM = {};      // {Fajr:"05:11", ...}
    let lastHitKey = null;   // Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©

    function showErr(msg){
      errBox.style.display = "block";
      errBox.textContent = msg;
    }
    function clearErr(){
      errBox.style.display = "none";
      errBox.textContent = "";
    }

    function fmtDateAr(d){
      return new Intl.DateTimeFormat("ar-IQ", {
        timeZone: BAGHDAD_TZ,
        weekday:"long",
        day:"2-digit",
        month:"long",
        year:"numeric"
      }).format(d);
    }

    function fmt12(hhmm){
      const [hStr,mStr] = hhmm.split(":");
      let h = Number(hStr);
      const m = Number(mStr);
      const isPM = h >= 12;
      h = h % 12; if(h === 0) h = 12;
      const mm = String(m).padStart(2,"0");
      return `${h}:${mm} ${isPM ? "Ù…" : "Øµ"}`;
    }

    // ÙˆÙ‚Øª Ø¨ØºØ¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ HH:MM
    function nowHHMM(){
      return new Intl.DateTimeFormat("en-GB", {
        timeZone: BAGHDAD_TZ,
        hour:"2-digit",
        minute:"2-digit",
        hour12:false
      }).format(new Date());
    }

    // Ù…ÙØªØ§Ø­ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ø£Ø°Ø§Ù†
    function minuteKey(){
      return new Intl.DateTimeFormat("en-CA", {
        timeZone: BAGHDAD_TZ,
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit",
        hour12:false
      }).format(new Date());
    }

    async function fetchTimings(){
      clearErr();
      try{
        // method=0 (Shia Ithna-Ashari / Jafari) Ø­Ø³Ø¨ AlAdhan
        const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(CITY)}&country=${encodeURIComponent(COUNTRY)}&method=0`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        const t = data?.data?.timings;
        if(!t) throw new Error("No timings");

        // Ù†Ø®Ø²Ù† Ø£Ù‡Ù… Ø§Ù„Ø£ÙˆÙ‚Ø§Øª (HH:MM ÙÙ‚Ø·)
        timesHHMM = {
          Imsak: String(t.Imsak || "").slice(0,5),
          Fajr: String(t.Fajr || "").slice(0,5),
          Sunrise: String(t.Sunrise || "").slice(0,5),
          Dhuhr: String(t.Dhuhr || "").slice(0,5),
          Asr: String(t.Asr || "").slice(0,5),
          Maghrib: String(t.Maghrib || "").slice(0,5),
          Isha: String(t.Isha || "").slice(0,5),
        };

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ/Ø§Ù„Ø¥ÙØ·Ø§Ø±
        $("imsakT").textContent = fmt12(timesHHMM.Imsak || "--:--");
        $("iftarT").textContent = fmt12(timesHHMM.Maghrib || "--:--");
        $("imsakN").textContent = "Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ = ØªÙˆÙ‚Ù Ø§Ù„Ø£ÙƒÙ„ (Ù‚Ø¨Ù„ Ø§Ù„ÙØ¬Ø±)";
        $("iftarN").textContent = "Ø§Ù„Ø¥ÙØ·Ø§Ø± = ÙˆÙ‚Øª Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨";

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª
        const rows = [
          ["Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ", timesHHMM.Imsak, "â³"],
          ["Ø§Ù„ÙØ¬Ø±", timesHHMM.Fajr, "ğŸ””"],
          ["Ø§Ù„Ø´Ø±ÙˆÙ‚", timesHHMM.Sunrise, "â˜€ï¸"],
          ["Ø§Ù„Ø¸Ù‡Ø±", timesHHMM.Dhuhr, "ğŸ””"],
          ["Ø§Ù„Ø¹ØµØ±", timesHHMM.Asr, "ğŸ””"],
          ["Ø§Ù„Ù…ØºØ±Ø¨", timesHHMM.Maghrib, "ğŸŒ™"],
          ["Ø§Ù„Ø¹Ø´Ø§Ø¡", timesHHMM.Isha, "âœ¨"],
        ];

        const list = $("prayList");
        list.innerHTML = "";
        for(const [name, time, ico] of rows){
          const safe = (time && time.includes(":")) ? fmt12(time) : "--:--";
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `<span class="name">${ico} ${name}</span><span class="time">${safe}</span>`;
          list.appendChild(div);
        }

        $("topSub").textContent = `Ø§Ù„Ø¨ØµØ±Ø© â€” ${fmtDateAr(new Date())}`;

      }catch(e){
        showErr("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª Ø«Ù… Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ«.");
      }
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ø¹Ù†Ø¯ Ø£ÙŠ Ù…ÙˆØ¹Ø¯
    async function maybePlayAdhan(){
      if(!adhanEnabled) return;
      const hhmm = nowHHMM();
      const k = minuteKey();
      if(lastHitKey === k) return;

      // Ø£ÙŠ ÙˆÙ‚Øª ØªØ±ÙŠØ¯ Ø§Ù„Ø£Ø°Ø§Ù† ÙŠØ´ØªØºÙ„ Ø¹Ù„ÙŠÙ‡ØŸ
      const hit =
        hhmm === timesHHMM.Fajr ||
        hhmm === timesHHMM.Dhuhr ||
        hhmm === timesHHMM.Asr ||
        hhmm === timesHHMM.Maghrib ||
        hhmm === timesHHMM.Isha;

      if(!hit) return;

      lastHitKey = k;

      try{
        adhanAudio.currentTime = 0;
        await adhanAudio.play();
      }catch{
        // Ø¥Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ø§Ù„ØµÙˆØªØŒ Ù†Ø®Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©
        adhanEnabled = false;
        $("enableAdhan").textContent = "ğŸ”Š ØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†";
        showErr("Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª. Ø§Ø¶ØºØ· (ØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†) Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.");
      }
    }

    $("enableAdhan").addEventListener("click", async ()=>{
      clearErr();
      try{
        // "Unlock" Ù„Ù„ØµÙˆØª
        adhanAudio.volume = 1;
        adhanAudio.currentTime = 0;
        await adhanAudio.play();
        adhanAudio.pause();
        adhanAudio.currentTime = 0;

        adhanEnabled = true;
        $("enableAdhan").textContent = "âœ… Ø§Ù„Ø£Ø°Ø§Ù† Ù…ÙØ¹Ù„";
      }catch{
        showErr("Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£ÙØ¹Ù„ Ø§Ù„ØµÙˆØª. Ø¬Ø±Ù‘Ø¨ ØªØ¶ØºØ· Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.");
      }
    });

    $("refreshBtn").addEventListener("click", fetchTimings);

    // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© (ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ)
    setInterval(maybePlayAdhan, 10 * 1000);

    // Init
    fetchTimings();
  </script>
</body>
</html>
