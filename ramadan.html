<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>â˜¾ Ø±Ù…Ø¶Ø§Ù† â€” Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ ÙˆØ§Ù„Ø¥ÙØ·Ø§Ø± + Ø§Ù„Ø£Ø°Ø§Ù†</title>
  <meta name="theme-color" content="#0b1220">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --text:#eef2ff;
      --muted: rgba(238,242,255,.78);
      --border: rgba(255,255,255,.16);
      --glass: rgba(255,255,255,.10);
      --glass2: rgba(255,255,255,.06);
      --shadow: 0 18px 55px rgba(0,0,0,.40);
      --danger: rgba(244,63,94,.90);
      --ok: rgba(34,197,94,.95);
      --warn: rgba(250,204,21,.95);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Cairo", system-ui, Arial;
      color: var(--text);
      overflow-x:hidden;
      padding: 14px 14px 22px;
      background:#0b1220;
    }

    /* ===== Background video (ONLY) ===== */
    .bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-6;
      transform: scale(1.03);
      filter: saturate(1.06) contrast(1.05) brightness(.62);
    }
    .overlay{
      position:fixed; inset:0;
      z-index:-5;
      background:
        radial-gradient(950px 540px at 80% 18%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(760px 460px at 20% 84%, rgba(59,130,246,.12), transparent 55%),
        linear-gradient(120deg, rgba(0,0,0,.62), rgba(0,0,0,.36));
    }

    /* ===== Top bar ===== */
    .topBar{
      width:min(980px, 100%);
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
    }
    .title{
      margin:0;
      font-weight: 900;
      font-size: 16px;
      letter-spacing:.2px;
      user-select:none;
    }
    .sub{
      margin:0;
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
    }
    .leftGrp{ display:flex; flex-direction:column; gap:2px; }
    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-family:inherit;
      font-weight: 900;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.14); }

    .wrap{
      width:min(980px, 100%);
      margin: 12px auto 0;
      display:grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }

    /* ===== Glass panels (no big container) ===== */
    .panel{
      border-radius: 22px;
      border: 1px solid var(--border);
      background: var(--glass);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHd{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .panelHd h2{
      margin:0;
      font-weight: 900;
      font-size: 14px;
      letter-spacing:.2px;
      user-select:none;
    }
    .panelBd{ padding: 12px 14px 14px; }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      line-height: 1.8;
    }

    /* ===== Cards grid ===== */
    .grid2{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr 1fr;
    }
    @media(max-width: 700px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .tile{
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.14);
      background: var(--glass2);
      padding: 14px;
    }
    .k{
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      user-select:none;
    }
    .v{
      margin-top: 6px;
      font-weight: 900;
      font-size: 34px;
      letter-spacing:.3px;
      user-select:none;
    }
    .small{
      margin-top: 6px;
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
    }
    .count{
      margin-top: 10px;
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.3px;
      user-select:none;
    }

    /* ===== list ===== */
    .list{
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .row{
      display:grid;
      grid-template-columns: 24px 1fr 120px;
      gap:10px;
      align-items:center;
      padding: 12px 14px;
      border-bottom: 1px dashed rgba(255,255,255,.18);
      font-weight: 900;
    }
    .row:last-child{ border-bottom:none; }
    .ico{ opacity:.9; text-align:center; }
    .name{ opacity:.95; }
    .time{ text-align:left; opacity:.95; letter-spacing:.3px; }

    /* ===== Error ===== */
    .err{
      display:none;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(244,63,94,.14);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      line-height: 1.8;
    }

    /* ===== EVENT OVERLAY (3 seconds) ===== */
    .evt{
      position:fixed; inset:0;
      z-index: 500;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 20px;
      background: rgba(0,0,0,.48);
      backdrop-filter: blur(2px);
    }
    .evt.show{ display:flex; animation: fadeIn .18s ease both; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

    .evtBox{
      width:min(760px, 100%);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(14px);
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      padding: 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    /* Ù†Ø¨Ø¶Ø§Øª Ø®Ù„ÙÙŠØ© */
    .pulseBG{
      position:absolute; inset:-80px;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(255,255,255,.10), transparent 60%);
      filter: blur(2px);
      animation: pulse 1.15s ease-in-out infinite;
      opacity:.85;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(.96); opacity:.65; }
      50%{ transform: scale(1.06); opacity:1; }
    }
    .evtTitle{
      position:relative;
      margin:0;
      font-weight: 900;
      font-size: 34px;
      letter-spacing:.6px;
      text-shadow: 0 0 22px rgba(255,255,255,.22);
    }
    .evtSub{
      position:relative;
      margin: 8px 0 0;
      font-weight: 900;
      font-size: 14px;
      color: rgba(255,255,255,.82);
      line-height: 1.8;
    }
    .evtMini{
      position:relative;
      margin-top: 10px;
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,.72);
    }
  </style>
</head>

<body>
  <video class="bgVideo" autoplay muted loop playsinline>
    <source src="bg1.mp4.mp4?v=2" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <!-- Event overlay -->
  <div class="evt" id="evt">
    <div class="evtBox">
      <div class="pulseBG"></div>
      <h1 class="evtTitle" id="evtTitle">...</h1>
      <p class="evtSub" id="evtSub">...</p>
      <div class="evtMini" id="evtMini">...</div>
    </div>
  </div>

  <header class="topBar">
    <div class="leftGrp">
      <p class="title">â˜¾ Ø±Ù…Ø¶Ø§Ù† â€” Ø§Ù„Ø¨ØµØ±Ø©</p>
      <p class="sub" id="topSub">... ØªØ­Ù…ÙŠÙ„</p>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
      <button class="btn" id="enableAdhan">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†</button>
      <button class="btn" id="refreshBtn">âŸ³ ØªØ­Ø¯ÙŠØ«</button>
      <a class="btn" href="index.html">â†© Ø±Ø¬ÙˆØ¹</a>
    </div>
  </header>

  <main class="wrap">
    <div class="err" id="errBox"></div>

    <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <section class="panel">
      <div class="panelHd">
        <h2>Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø¨Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© + Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)</h2>
        <span class="sub" id="nowClock">--:--</span>
      </div>

      <div class="panelBd">
        <div class="grid2">
          <div class="tile">
            <div class="k">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</div>
            <div class="v" id="imsakT">--:--</div>
            <div class="count" id="imsakCount">... ØªØ­Ù…ÙŠÙ„</div>
            <div class="small" id="imsakHint">...</div>
          </div>

          <div class="tile">
            <div class="k">Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø§Ù„Ù…ØºØ±Ø¨)</div>
            <div class="v" id="iftarT">--:--</div>
            <div class="count" id="iftarCount">... ØªØ­Ù…ÙŠÙ„</div>
            <div class="small" id="iftarHint">...</div>
          </div>
        </div>

        <div class="hint">
          â€¢ Ø¨Ø¹Ø¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ ÙŠØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª. <br>
          â€¢ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙŠØºØ·ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù…Ø¯Ø© 3 Ø«ÙˆØ§Ù†ÙŠ Ø¹Ù†Ø¯ ÙƒÙ„ Ø­Ø¯Ø«.
        </div>
      </div>
    </section>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª -->
    <section class="panel">
      <div class="panelHd">
        <h2>Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ÙŠÙˆÙ… (12 Ø³Ø§Ø¹Ø©)</h2>
        <span class="sub" id="pUpdated">... ØªØ­Ù…ÙŠÙ„</span>
      </div>
      <div class="panelBd">
        <div class="list" id="prayList"></div>
      </div>
    </section>
  </main>

  <!-- âœ… Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†: Ø§Ù†Øª Ù‚Ù„Øª Ø§Ø³Ù…Ù‡ adhan.mp3.mp3 -->
  <audio id="adhanAudio" src="adhan.mp3.mp3" preload="auto"></audio>

  <script>
    // ===== Settings =====
    const BAGHDAD_TZ = "Asia/Baghdad";
    const CITY = "Basra";
    const COUNTRY = "Iraq";

    // ===== Helpers =====
    const $ = (id)=>document.getElementById(id);
    const errBox = $("errBox");
    const adhanAudio = $("adhanAudio");

    let adhanEnabled = false;
    let times = {};          // {Imsak:"05:xx", Fajr:"..", ...}
    let lastHitKey = null;   // Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
    let overlayTimer = null;

    function showErr(msg){
      errBox.style.display = "block";
      errBox.textContent = msg;
    }
    function clearErr(){
      errBox.style.display = "none";
      errBox.textContent = "";
    }

    function fmtDateAr(d){
      return new Intl.DateTimeFormat("ar-IQ", {
        timeZone: BAGHDAD_TZ,
        weekday:"long",
        day:"2-digit",
        month:"long",
        year:"numeric"
      }).format(d);
    }

    function nowHHMM(){
      return new Intl.DateTimeFormat("en-GB", {
        timeZone: BAGHDAD_TZ,
        hour:"2-digit",
        minute:"2-digit",
        hour12:false
      }).format(new Date());
    }

    function minuteKey(){
      return new Intl.DateTimeFormat("en-CA", {
        timeZone: BAGHDAD_TZ,
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit",
        hour12:false
      }).format(new Date());
    }

    function fmt12(hhmm){
      const [hStr,mStr] = hhmm.split(":");
      let h = Number(hStr);
      const m = Number(mStr);
      const isPM = h >= 12;
      h = h % 12; if(h === 0) h = 12;
      const mm = String(m).padStart(2,"0");
      return `${h}:${mm} ${isPM ? "Ù…" : "Øµ"}`;
    }

    function parseHHMMToDateToday(hhmm){
      // ÙŠØ±Ø¬Ù‘Ø¹ Date Ù„Ù„ÙŠÙˆÙ… (Ø¨ØªÙˆÙ‚ÙŠØª Ø¨ØºØ¯Ø§Ø¯) Ø¹Ù„Ù‰ hh:mm
      if(!/^\d{2}:\d{2}$/.test(hhmm)) return null;

      const now = new Date();
      const inBaghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
      const y = inBaghdad.getFullYear();
      const mo = inBaghdad.getMonth();
      const d = inBaghdad.getDate();

      const [hh, mm] = hhmm.split(":").map(Number);
      // Ù†Ø¨Ù†ÙŠÙ‡ ÙƒÙ€ UTC Ø«Ù… Ù†Ø¹ØªØ¨Ø±Ù‡ Baghdad (Ù†Ø´ØªØºÙ„ Ø¹Ù„Ù‰ Ù†ÙØ³ inBaghdad)
      const dt = new Date(Date.UTC(y, mo, d, hh, mm, 0));
      // Ù†Ø±Ø¬Ø¹Ù‡ ÙƒÙ€ "wall clock" Ø¨ØºØ¯Ø§Ø¯: Ù†Ø­ØªØ§Ø¬ Ù†Ø­ÙˆÙ„Ù‡ Ù„Ø·Ø±ÙŠÙ‚Ø© Ù…Ù‚Ø§Ø±Ù†Ø©
      // Ø£Ø¨Ø³Ø·: Ù†Ø±Ø¬Ù‘Ø¹ Timestamp Ø¨ØºØ¯Ø§Ø¯ Ø¹Ø¨Ø± ÙØ±Ù‚ Ù…Ø­Ù„ÙŠ:
      // Ù†Ø³ØªØ®Ø¯Ù… toLocaleString Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ù„ØªØ«Ø¨ÙŠØª
      const fixed = new Date(new Date(dt).toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));
      return fixed;
    }

    function diffToText(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const hh = Math.floor(s / 3600);
      const mm = Math.floor((s % 3600) / 60);
      const ss = s % 60;
      return `${String(hh).padStart(2,"0")}:${String(mm).padStart(2,"0")}:${String(ss).padStart(2,"0")}`;
    }

    function showOverlay(title, sub){
      const evt = $("evt");
      $("evtTitle").textContent = title;
      $("evtSub").textContent = sub || "";
      $("evtMini").textContent = fmtDateAr(new Date());

      evt.classList.add("show");
      clearTimeout(overlayTimer);
      overlayTimer = setTimeout(()=> evt.classList.remove("show"), 3000);
    }

    async function tryPlayAdhan(){
      if(!adhanEnabled) return;
      try{
        adhanAudio.currentTime = 0;
        adhanAudio.muted = false;
        adhanAudio.volume = 1;
        await adhanAudio.play();
      }catch{
        adhanEnabled = false;
        $("enableAdhan").textContent = "ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†";
        showErr("Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª. Ø§Ø¶ØºØ· (ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†) Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.");
      }
    }

    // ===== Fetch timings (Jafari / Shia) =====
    async function fetchTimings(){
      clearErr();
      try{
        const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(CITY)}&country=${encodeURIComponent(COUNTRY)}&method=0`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const t = data?.data?.timings;
        if(!t) throw new Error("No timings");

        const cut = (x)=> String(x||"").slice(0,5);

        times = {
          Imsak: cut(t.Imsak),
          Fajr: cut(t.Fajr),
          Sunrise: cut(t.Sunrise),
          Dhuhr: cut(t.Dhuhr),
          Asr: cut(t.Asr),
          Maghrib: cut(t.Maghrib),
          Isha: cut(t.Isha),
        };

        $("topSub").textContent = `Ø§Ù„Ø¨ØµØ±Ø© â€” ${fmtDateAr(new Date())}`;
        $("pUpdated").textContent = "Ù…Ø­Ø¯Ù‘Ø« Ø§Ù„ÙŠÙˆÙ…";

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ/Ø§Ù„Ø¥ÙØ·Ø§Ø±
        $("imsakT").textContent = times.Imsak ? fmt12(times.Imsak) : "--:--";
        $("iftarT").textContent = times.Maghrib ? fmt12(times.Maghrib) : "--:--";

        $("imsakHint").textContent = "Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ = Ù†Ù‡Ø§ÙŠØ© ÙˆÙ‚Øª Ø§Ù„Ø³Ø­ÙˆØ±";
        $("iftarHint").textContent = "Ø§Ù„Ø¥ÙØ·Ø§Ø± = ÙˆÙ‚Øª Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨";

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
        const rows = [
          ["â³","Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ", times.Imsak],
          ["ğŸ””","Ø§Ù„ÙØ¬Ø±", times.Fajr],
          ["â˜€ï¸","Ø§Ù„Ø´Ø±ÙˆÙ‚", times.Sunrise],
          ["ğŸ””","Ø§Ù„Ø¸Ù‡Ø±", times.Dhuhr],
          ["ğŸ””","Ø§Ù„Ø¹ØµØ±", times.Asr],
          ["ğŸŒ™","Ø§Ù„Ù…ØºØ±Ø¨ (Ø¥ÙØ·Ø§Ø±)", times.Maghrib],
          ["âœ¨","Ø§Ù„Ø¹Ø´Ø§Ø¡", times.Isha],
        ];

        const list = $("prayList");
        list.innerHTML = "";
        for(const [ico, name, hhmm] of rows){
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `
            <div class="ico">${ico}</div>
            <div class="name">${name}</div>
            <div class="time">${hhmm ? fmt12(hhmm) : "--:--"}</div>
          `;
          list.appendChild(div);
        }
      }catch(e){
        showErr("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª Ø«Ù… Ø§Ø¶ØºØ· ØªØ­Ø¯ÙŠØ«.");
        $("pUpdated").textContent = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
      }
    }

    // ===== Countdown updater =====
    function updateCountdowns(){
      $("nowClock").textContent = nowHHMM();

      const now = new Date();
      const nowBaghdad = new Date(now.toLocaleString("en-US", { timeZone: BAGHDAD_TZ }));

      // Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ
      const imsakDT = parseHHMMToDateToday(times.Imsak || "");
      if(imsakDT){
        let diff = imsakDT.getTime() - nowBaghdad.getTime();
        if(diff < 0){
          // Ø¥Ø°Ø§ ÙØ§ØªØŒ Ø®Ù„ÙŠÙ‘Ù‡ Ù„Ù„ØºØ¯
          const tomorrow = new Date(imsakDT.getTime() + 24*60*60*1000);
          diff = tomorrow.getTime() - nowBaghdad.getTime();
        }
        $("imsakCount").textContent = `Ø¨Ø§Ù‚ÙŠ: ${diffToText(diff)}`;
      }else{
        $("imsakCount").textContent = "... ØªØ­Ù…ÙŠÙ„";
      }

      // Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø§Ù„Ù…ØºØ±Ø¨)
      const iftarDT = parseHHMMToDateToday(times.Maghrib || "");
      if(iftarDT){
        let diff = iftarDT.getTime() - nowBaghdad.getTime();
        if(diff < 0){
          const tomorrow = new Date(iftarDT.getTime() + 24*60*60*1000);
          diff = tomorrow.getTime() - nowBaghdad.getTime();
        }
        $("iftarCount").textContent = `Ø¨Ø§Ù‚ÙŠ: ${diffToText(diff)}`;
      }else{
        $("iftarCount").textContent = "... ØªØ­Ù…ÙŠÙ„";
      }
    }

    // ===== Event detector (overlay + adhan) =====
    async function tickEvents(){
      if(!times || !times.Fajr) return;

      const hhmm = nowHHMM();
      const k = minuteKey();
      if(lastHitKey === k) return; // Ù†ÙØ³ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©

      // Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„ÙŠ ØªØ±ÙŠØ¯Ù‡Ø§
      const map = {
        Imsak: { label:"â³ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ", msg:"ØªÙˆÙ‚Ù Ø§Ù„Ø£ÙƒÙ„ â€” Ù†ÙŠØ© Ø§Ù„ØµÙŠØ§Ù… ğŸ¤", play:false },
        Fajr: { label:"ğŸ”” Ø£Ø°Ø§Ù† Ø§Ù„ÙØ¬Ø±", msg:"ØµÙ„Ø§Ø© Ø§Ù„ØµØ¨Ø­", play:true },
        Asr: { label:"ğŸ”” Ø£Ø°Ø§Ù† Ø§Ù„Ø¹ØµØ±", msg:"ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±", play:true },
        Maghrib: { label:"ğŸŒ™ Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨", msg:"Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø¥ÙØ·Ø§Ø±", play:true },
        Isha: { label:"âœ¨ Ø£Ø°Ø§Ù† Ø§Ù„Ø¹Ø´Ø§Ø¡", msg:"ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡", play:true },
      };

      // ØªØ·Ø§Ø¨Ù‚ØŸ
      let hitKey = null;
      if(hhmm === times.Imsak) hitKey = "Imsak";
      else if(hhmm === times.Fajr) hitKey = "Fajr";
      else if(hhmm === times.Asr) hitKey = "Asr";
      else if(hhmm === times.Maghrib) hitKey = "Maghrib";
      else if(hhmm === times.Isha) hitKey = "Isha";

      if(!hitKey) return;

      lastHitKey = k;

      // Overlay 3s
      showOverlay(map[hitKey].label, map[hitKey].msg);

      // ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† Ø¥Ø°Ø§ Ù„Ø§Ø²Ù…
      if(map[hitKey].play) await tryPlayAdhan();

      // Ø­Ø¯Ø« Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ù…Ù† Ø§Ù„Ù…ØºØ±Ø¨)
      if(hitKey === "Maghrib"){
        // ØªØ±ÙŠØ¯ Ø¹Ù†ÙˆØ§Ù† Ø«Ø§Ù†ÙŠ Ø®Ø§Øµ Ø¨Ø§Ù„Ø¥ÙØ·Ø§Ø±ØŸ (Ø¨Ø¯ÙˆÙ† ØµÙˆØª Ø¥Ø¶Ø§ÙÙŠ)
        // showOverlay("ğŸ½ï¸ Ø§Ù„Ø¥ÙØ·Ø§Ø±", "ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ ØµÙŠØ§Ù…ÙƒÙ… ğŸ¤");
      }
    }

    // ===== Enable adhan button (Ù…Ø¹ Ù…Ù„ÙÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯) =====
    $("enableAdhan").addEventListener("click", async ()=>{
      clearErr();
      try{
        adhanAudio.load();
        adhanAudio.muted = false;
        adhanAudio.volume = 1;
        adhanAudio.currentTime = 0;

        // ØªØ´ØºÙŠÙ„ â€œunlockâ€ (250ms)
        await adhanAudio.play();
        setTimeout(()=>{
          try{
            adhanAudio.pause();
            adhanAudio.currentTime = 0;
          }catch{}
        }, 250);

        adhanEnabled = true;
        $("enableAdhan").textContent = "âœ… Ø§Ù„Ø£Ø°Ø§Ù† Ù…ÙØ¹Ù„";
        showOverlay("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†", "Ø³ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª");
      }catch(e){
        showErr(
          "Ù…Ø§ Ø£Ú¯Ø¯Ø± Ø£ÙØ¹Ù„ Ø§Ù„ØµÙˆØª.\n" +
          "1) ØªØ£ÙƒØ¯ Ø±Ø§Ø¨Ø· adhan.mp3.mp3 ÙŠÙØªØ­ Ø¨Ø¯ÙˆÙ† 404.\n" +
          "2) Ø¥Ø°Ø§ ÙØ§ØªØ­ Ù…Ù† Ø¯Ø§Ø®Ù„ Instagram Ø§ÙØªØ­ Ù…Ù† Chrome.\n" +
          "3) Ø¬Ø±Ù‘Ø¨ Ù…Ù„Ù Ø£ØµØºØ± Ø¥Ø°Ø§ Ø­Ø¬Ù…Ù‡ ÙƒØ¨ÙŠØ±."
        );
      }
    });

    $("refreshBtn").addEventListener("click", async ()=>{
      await fetchTimings();
      updateCountdowns();
      showOverlay("âŸ³ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ÙŠÙˆÙ…");
    });

    // ===== Init =====
    (async function init(){
      $("topSub").textContent = "ØªØ­Ù…ÙŠÙ„...";
      await fetchTimings();
      updateCountdowns();

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
      setInterval(updateCountdowns, 1000);

      // ÙØ­Øµ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙƒÙ„ 1 Ø«Ø§Ù†ÙŠØ© (Ø¨Ø³ Ù…Ø§ ÙŠØªÙƒØ±Ø± Ø¨Ø³Ø¨Ø¨ minuteKey)
      setInterval(tickEvents, 1000);
    })();
  </script>
</body>
</html>
